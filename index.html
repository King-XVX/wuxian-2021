<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>无限工作室 | INFINITY STUDIO</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap');

/* 核心样式 */
.cyber-border {
  border: 1px solid rgba(0,238,255,0.3);
  box-shadow: 0 0 12px rgba(0,238,255,0.15);
}

.cyber-card:hover {
  box-shadow: 0 0 20px rgba(0,238,255,0.25);
  transform: translateY(-5px);
  transition: all 0.3s ease;
}

.glass {
  background: rgba(5,8,16,0.85);
  backdrop-filter: blur(16px);
}

.neon {
  color: #00cccc;
  text-shadow: 0 0 10px rgba(0,238,255,0.4);
  animation: neon 3s infinite alternate ease-in-out;
}

@keyframes neon {
  0% { text-shadow: 0 0 8px rgba(0,238,255,0.4); opacity: 0.85; }
  100% { text-shadow: 0 0 12px rgba(0,238,255,0.6); opacity: 0.95; }
}

.fade-in { animation: fadeIn 0.5s ease forwards; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.slide-up { animation: slideUp 0.5s ease forwards; }
@keyframes slideUp { from { opacity:0; transform: translateY(30px); } to { opacity:1; transform: translateY(0); } }

.img-scale { transition: transform 0.4s ease; }
.img-scale:hover { transform: scale(1.08); }

.carousel-item { display: none; }
.carousel-item.active { display: block; animation: fadeIn 0.8s ease; }

.scroll-smooth { scroll-behavior: smooth; }

/* 新增的CSS样式 */
#notificationContainer {
  pointer-events: none;
}

#notificationContainer > div {
  pointer-events: auto;
  animation: slideInRight 0.3s ease-out;
}

@keyframes slideInRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.file-item {
  cursor: pointer;
  transition: all 0.2s ease;
}

.file-item.selected {
  border-color: var(--color-primary, #0ef);
  background-color: rgba(0, 238, 255, 0.05);
}

.theme-option {
  transition: all 0.2s ease;
}

.theme-option:hover {
  transform: translateY(-2px);
}

/* 搜索框动画 */
#globalSearch:focus {
  box-shadow: 0 0 0 2px rgba(0, 238, 255, 0.2);
}

/* 批量操作工具栏动画 */
#batchTools {
  animation: slideUpIn 0.3s ease-out;
}

@keyframes slideUpIn {
  from {
    transform: translateY(100%);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* 移动端优化 */
@media (max-width: 768px) {
  .mobile-hidden {
    display: none;
  }
  .mobile-full {
    width: 100%;
  }
}
</style>
</head>
<body class="bg-[#050810] text-gray-300 min-h-screen font-sans scroll-smooth">
<div id="app" class="min-h-screen flex flex-col">

<!-- 导航栏 -->
<nav class="fixed w-full z-50 glass border-b border-[#0ef]/40 py-3">
  <div class="container mx-auto px-4 flex items-center justify-between">
    <a href="#home" class="text-xl font-bold text-white neon font-orbitron">INFINITY 无限</a>
    <div class="hidden md:flex gap-4 items-center">
      <a href="#home" class="hover:text-[#0ef] transition px-2">首页</a>
      <a href="#portfolio" class="hover:text-[#0ef] transition px-2">作品集</a>
      <a href="#team" class="hover:text-[#0ef] transition px-2">团队</a>
      <a href="#install" class="hover:text-[#0ef] transition px-2">文件中心</a>
      <a href="#forum" class="hover:text-[#0ef] transition px-2">论坛</a>
      <div class="relative">
        <input type="text" 
               id="globalSearch" 
               placeholder="搜索文件、帖子..." 
               class="bg-gray-900 border border-gray-700 rounded px-4 py-1 text-sm w-48 focus:w-64 transition-all duration-300 focus:border-[#0ef] focus:outline-none">
        <i class="fa fa-search absolute right-3 top-2 text-gray-500"></i>
        <div id="searchResults" class="absolute top-full left-0 right-0 mt-1 bg-[#050810] cyber-border rounded-lg shadow-xl hidden max-h-96 overflow-y-auto z-50"></div>
      </div>
      <button id="profileBtn" class="hover:text-[#0ef] transition px-2 hidden"><i class="fa fa-user mr-1"></i>个人中心</button>
      <button id="adminBtn" class="px-3 py-1 bg-[#f0a] text-white rounded hover:brightness-110 transition hidden ml-2">管理</button>
      <button id="loginToggle" class="px-4 py-2 bg-[#0ef] text-[#050810] rounded hover:brightness-110 transition">登录</button>
    </div>
    <button class="md:hidden text-xl" id="menuBtn"><i class="fa fa-bars"></i></button>
  </div>
</nav>



<!-- 移动端菜单 -->
<div id="mobileMenu" class="fixed top-16 left-0 right-0 glass hidden border-b border-[#0ef]/30 z-40">
  <div class="container px-4 py-3 flex flex-col gap-3">
    <a href="#home" class="py-2 hover:text-[#0ef]">首页</a>
    <a href="#portfolio" class="py-2 hover:text-[#0ef]">作品集</a>
    <a href="#team" class="py-2 hover:text-[#0ef]">团队</a>
    <a href="#install" class="py-2 hover:text-[#0ef]">文件中心</a>
    <a href="#forum" class="py-2 hover:text-[#0ef]">论坛</a>
    <button id="mobileProfile" class="py-2 text-left hover:text-[#0ef] hidden"><i class="fa fa-user mr-2"></i>个人中心</button>
    <button id="mobileAdmin" class="py-2 text-left bg-[#f0a] text-white rounded hidden">管理后台</button>
    <button id="mobileLogin" class="py-2 bg-[#0ef] text-[#050810] rounded">登录</button>
  </div>
</div>

<main class="flex-1 pt-16">
<!-- 首页区域 -->
<!-- 首页轮播 -->
<section id="home" class="relative min-h-[90vh] flex items-center justify-center overflow-hidden">
  <!-- 背景图片层 -->
  <div class="absolute inset-0 bg-[url('https://i.ibb.co/r2kB5zgP/wx.png')] bg-cover bg-center bg-fixed"></div>

  <!-- 颜色遮罩层 -->
  <div class="absolute inset-0 bg-gradient-to-br from-blue-900/20 via-purple-900/10 to-pink-900/20"></div>

  <!-- 暗色遮罩 -->
  <div class="absolute inset-0 bg-black/50"></div>

  <!-- 网格效果 -->
  <div class="absolute inset-0" style="
    background-image:
      linear-gradient(rgba(0,238,255,0.1) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,238,255,0.1) 1px, transparent 1px);
    background-size: 50px 50px;
    background-position: -1px -1px;
  "></div>

  <!-- 扫描线效果 -->
  <div class="absolute inset-0 opacity-10" style="
    background: linear-gradient(transparent 50%, rgba(0,238,255,0.05) 50%);
    background-size: 100% 4px;
  "></div>

  <!-- 轮播内容 -->
  <div class="carousel relative z-10 container px-4 text-center max-w-4xl">
    <div class="carousel-item active fade-in">
      <h1 class="text-4xl md:text-7xl font-bold text-white neon slide-up" data-text="无限创意设计">无限创意设计</h1>
      <p class="mt-6 text-gray-300 text-lg slide-up delay-100">专注视觉小说,人物设定,数字工艺 | 赛博朋克创作工作室</p>
      <div class="mt-8 flex flex-wrap justify-center gap-10 slide-up delay-200">
        <a href="#portfolio" class="px-8 py-3 bg-[#0ef] text-[#050810] rounded hover:brightness-110 transition uppercase tracking-wider">浏览作品</a>
        <a href="#forum" class="px-6 py-3 border border-[#0ef] text-[#0ef] rounded hover:bg-[#0ef]/10 transition uppercase tracking-wider">加入讨论</a>
      </div>
    </div>
  </div>
</section>

<!-- 文件中心 -->
<section id="install" class="py-16 bg-[#050810]/50">
  <div class="container mx-auto px-4 max-w-5xl">
    <h2 class="text-3xl font-bold text-center mb-3 neon">文件中心</h2>
    <p class="text-center text-gray-400 mb-8">上传、分享、下载项目文件 - 永久存储，所有人可见</p>
    
    <!-- 上传区域 (登录后显示) -->
    <div id="uploadArea" class="mb-8 p-6 rounded-lg cyber-border bg-black/30 hidden">
      <h3 class="text-xl font-bold mb-4 text-[#0ef]"><i class="fa fa-upload mr-2"></i>上传文件</h3>
      <input id="fileName" placeholder="文件名称（必填）" class="w-full bg-gray-900 border border-gray-700 rounded px-4 py-2 mb-3">
      <textarea id="fileDesc" placeholder="文件描述（可选）" rows="2" class="w-full bg-gray-900 border border-gray-700 rounded px-4 py-2 mb-3"></textarea>
      <input type="file" id="fileInput" class="w-full bg-gray-900 border border-gray-700 rounded px-4 py-2 mb-3">
      <div class="text-xs text-gray-400 mb-4">
        支持任意类型文件，文件将永久保存
        <br><span class="text-yellow-400">建议文件大小不超过 10MB，大文件上传较慢</span>
      </div>
      <button id="uploadFile" class="w-full bg-[#0ef] text-[#050810] py-2 rounded hover:brightness-110 transition">上传文件</button>
    </div>
    
    <!-- 未登录提示 -->
    <div id="needLoginUpload" class="mb-8 p-6 rounded-lg cyber-border bg-black/30 text-center">
      <p class="mb-4">登录后可上传文件</p>
      <button onclick="showLogin()" class="px-6 py-2 bg-[#0ef] text-[#050810] rounded hover:brightness-110 transition">立即登录</button>
    </div>
    
    <!-- 文件列表 -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="fileGrid">
      <!-- 文件通过JS动态加载 -->
    </div>
  </div>
</section>

<!-- 作品集 -->
<section id="portfolio" class="py-16">
  <div class="container mx-auto px-4">
    <h2 class="text-3xl font-bold text-center mb-8 neon">作品集</h2>
<!--    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="portfolioGrid">-->
      <!-- 作品通过JS动态加载 -->
    <h2 class="text-3xl font-bold text-center mb-8 neon">暂无</h2>
    <h2 class="text-3xl font-bold text-center mb-8 neon">嗯，我们，所以把，对，就是，所以，我们，对，所以说，就是，哈哈</h2>
    <h2 class="text-3xl font-bold text-center mb-8 neon">对，就是，所以呢，就是吗，啊，好了，我不编了，这是为了凑字数</h2>
  </div>
</section>


<!-- 团队简介（工作室成员介绍） -->
<section id="team" class="py-16 bg-dark fade-in">
  <div class="container px-4">
    <h2 class="text-3xl font-bold text-center mb-12 neon">专业团队</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      <div class="p-6 cyber-border rounded-lg text-center bg-black/10 slide-up cyber-card">
        <img src="https://i.ibb.co/7db3SJzy/kl.jpg" class="w-28 h-28 rounded-full mx-auto object-cover border-2 border-primary" alt="鴋子">
        <h3 class="mt-4 font-bold text-lg">鴋子</h3>
        <p class="text-primary text-sm">创意提供</p>
      </div>
      <div class="p-6 cyber-border rounded-lg text-center bg-black/10 slide-up delay-100 cyber-card">
        <img src="https://i.ibb.co/ccrj1YXL/hs.jpg" class="w-28 h-28 rounded-full mx-auto object-cover border-2 border-primary" alt="霍斯">
        <h3 class="mt-4 font-bold text-lg">霍斯</h3>
        <p class="text-primary text-sm">文集综合</p>
      </div>
      <div class="p-6 cyber-border rounded-lg text-center bg-black/10 slide-up delay-200 cyber-card">
        <img src="https://i.ibb.co/C371q84q/kg.jpg" class="w-28 h-28 rounded-full mx-auto object-cover border-2 border-primary" alt="King_-G">
        <h3 class="mt-4 font-bold text-lg">King_-G</h3>
        <p class="text-primary text-sm">网页开发</p>
      </div>
      <div class="p-6 cyber-border rounded-lg text-center bg-black/10 slide-up delay-300 cyber-card">
        <img src="https://i.ibb.co/WW5W6qgB/lx.png" class="w-28 h-28 rounded-full mx-auto object-cover border-2 border-primary" alt="洛小">
        <h3 class="mt-4 font-bold text-lg">洛小</h3>
        <p class="text-primary text-sm">审核</p>
      </div>
    </div>

    <!-- 团队介绍 -->
    <div class="mt-12 max-w-3xl mx-auto text-center text-gray-300">
      <p class="mb-4">我们是一支充满激情和创造力的专业团队，致力于将赛博朋克美学与数字艺术完美融合。</p>
      <p class="mb-6">每位成员在各自的专业领域都有着深厚的造诣，共同构建 INFINITY 无限工作室的创意世界。</p>

      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
        <div class="cyber-border p-4 rounded-lg bg-black/20">
          <div class="text-2xl font-bold text-[#0ef]">: D</div>
          <div class="text-sm text-gray-400">项目经验</div>
        </div>
        <div class="cyber-border p-4 rounded-lg bg-black/20">
          <div class="text-2xl font-bold text-[#0ef]">100%</div>
          <div class="text-sm text-gray-400">我对团队的满意度</div>
        </div>
        <div class="cyber-border p-4 rounded-lg bg-black/20">
          <div class="text-2xl font-bold text-[#0ef]">很多人</div>
          <div class="text-sm text-gray-400">创意支持</div>
        </div>
        <div class="cyber-border p-4 rounded-lg bg-black/20">
          <div class="text-2xl font-bold text-[#0ef]">∞</div>
          <div class="text-sm text-gray-400">无限可能</div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- 论坛 -->
<section id="forum" class="py-16 bg-[#050810]/50">
  <div class="container px-4 max-w-5xl">
    <h2 class="text-3xl font-bold text-center mb-8 neon">创意论坛</h2>
    
    <div class="grid md:grid-cols-3 gap-8">
      <!-- 发帖区 -->
      <div class="md:col-span-1">
        <div class="cyber-border rounded-lg p-5 bg-black/30">
          <h3 class="font-bold mb-4 text-[#0ef]">发布话题</h3>
          <div id="postArea" class="hidden">
            <input id="postTitle" placeholder="标题" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 mb-3">
            <textarea id="postContent" rows="4" placeholder="内容" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 mb-3"></textarea>
            <button id="sendPost" class="w-full bg-[#0ef] text-[#050810] py-2 rounded hover:brightness-110 transition">发布</button>
          </div>
          <div id="needLoginPost" class="text-center py-4">
            <p class="mb-4">登录后可以发帖</p>
            <button onclick="showLogin()" class="px-6 py-2 bg-[#0ef] text-[#050810] rounded hover:brightness-110 transition">立即登录</button>
          </div>
        </div>
      </div>
      
      <!-- 帖子列表 -->
      <div class="md:col-span-2">
        <div class="cyber-border rounded-lg p-5 bg-black/30">
          <h3 class="font-bold text-[#0ef] mb-4">最新话题</h3>
          <div id="postList"></div>
          <div id="noPosts" class="text-center text-gray-400 py-8 hidden">
            <i class="fa fa-comments-o text-3xl mb-3"></i>
            <p>还没有帖子，发布第一个吧！</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- 个人中心 -->
<section id="profilePanel" class="py-16 hidden">
  <div class="container mx-auto px-4 max-w-3xl">
    <h2 class="text-3xl font-bold text-center mb-8 neon">个人中心</h2>
    <div class="cyber-border rounded-lg p-6 bg-black/30">
      <div class="mb-6">
        <label class="block text-sm font-medium mb-2">用户名设置</label>
        <input id="usernameInput" placeholder="设置你的显示用户名" class="w-full bg-gray-900 border border-gray-700 rounded px-4 py-2 mb-3">
        <button id="saveUsername" class="px-4 py-2 bg-[#0ef] text-[#050810] rounded hover:brightness-110 transition">保存用户名</button>
        <p class="text-xs text-gray-400 mt-2">设置后，你的帖子和文件将显示此用户名</p>
      </div>
      <div>
        <h3 class="font-bold mb-3">我的文件 <span class="text-sm text-gray-400" id="myFileCount">(0个)</span></h3>
        <div class="space-y-3 max-h-60 overflow-y-auto" id="myFiles">
          <!-- 我的文件列表 -->
        </div>
      </div>
      <!-- 主题设置 -->
      <div class="mt-6 border-t border-gray-800 pt-4">
        <h4 class="font-bold mb-3 text-[#0ef]">主题设置</h4>
        <div class="grid grid-cols-2 gap-3">
          <button onclick="setTheme('cyber')" class="flex items-center gap-2 p-3 rounded-lg border border-gray-700 hover:border-[#0ef] hover:bg-black/20 transition theme-option" data-theme="cyber">
            <div class="w-6 h-6 rounded-full" style="background: #0ef"></div>
            <span class="text-sm">赛博蓝</span>
          </button>
          <button onclick="setTheme('sunset')" class="flex items-center gap-2 p-3 rounded-lg border border-gray-700 hover:border-[#0ef] hover:bg-black/20 transition theme-option" data-theme="sunset">
            <div class="w-6 h-6 rounded-full" style="background: #ff6b35"></div>
            <span class="text-sm">落日橙</span>
          </button>
          <button onclick="setTheme('forest')" class="flex items-center gap-2 p-3 rounded-lg border border-gray-700 hover:border-[#0ef] hover:bg-black/20 transition theme-option" data-theme="forest">
            <div class="w-6 h-6 rounded-full" style="background: #00ff88"></div>
            <span class="text-sm">极光绿</span>
          </button>
          <button onclick="setTheme('midnight')" class="flex items-center gap-2 p-3 rounded-lg border border-gray-700 hover:border-[#0ef] hover:bg-black/20 transition theme-option" data-theme="midnight">
            <div class="w-6 h-6 rounded-full" style="background: #9d4edd"></div>
            <span class="text-sm">午夜紫</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- 管理后台 -->
<section id="adminPanel" class="py-16 hidden">
  <div class="container px-4 max-w-5xl">
    <h2 class="text-3xl font-bold text-center mb-8 neon">管理后台</h2>
    <!-- 统计面板 -->
    <div id="adminStats" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <!-- 统计内容通过JS动态加载 -->
    </div>
    <div class="grid md:grid-cols-2 gap-6">
      <!-- 用户管理 -->
      <div class="cyber-border rounded-lg p-6 bg-black/30">
        <h3 class="font-bold mb-4 text-[#0ef]">用户管理 <span class="text-sm text-gray-400">(共<span id="userCount">0</span>人)</span></h3>
        <div class="max-h-60 overflow-y-auto pr-2" id="adminUserList">
          <!-- 用户列表动态加载 -->
        </div>
      </div>
      
      <!-- 文件管理 -->
      <div class="cyber-border rounded-lg p-6 bg-black/30">
        <h3 class="font-bold mb-4 text-[#0ef]">文件管理 <span class="text-sm text-gray-400">(共<span id="fileCount">0</span>个)</span></h3>
        <div class="max-h-60 overflow-y-auto pr-2" id="adminFileList">
          <!-- 文件列表动态加载 -->
        </div>
      </div>
    </div>
  </div>
</section>
</main>

<!-- 登录注册弹窗 -->
<div id="loginModal" class="fixed inset-0 z-50 hidden">
  <div class="absolute inset-0 bg-black/80" onclick="hideLogin()"></div>
  <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-sm p-6 bg-[#050810] cyber-border rounded-lg fade-in">
    <h3 class="text-xl font-bold text-center mb-6 text-[#0ef]">登录 / 注册</h3>
    <input id="emailInput" type="email" placeholder="邮箱" class="w-full bg-gray-900 border border-gray-700 rounded px-4 py-2 mb-3">
    <input id="pwdInput" type="password" placeholder="密码" class="w-full bg-gray-900 border border-gray-700 rounded px-4 py-2 mb-3">
    <button id="loginBtn" class="w-full bg-[#0ef] text-[#050810] py-2 rounded hover:brightness-110 mb-2">登录</button>
    <button id="regBtn" class="w-full border border-[#0ef] text-[#0ef] py-2 rounded hover:bg-[#0ef]/10">注册</button>
    <p id="loginTip" class="text-center text-sm mt-3 hidden"></p>
    <div class="text-center text-xs text-gray-500 mt-4">
      测试管理员账号: admin@qq.com / admin123
    </div>
  </div>
</div>

<!-- 文件详情弹窗 -->
<div id="fileModal" class="fixed inset-0 z-50 hidden">
  <div class="absolute inset-0 bg-black/80" onclick="hideFileModal()"></div>
  <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-6 bg-[#050810] cyber-border rounded-lg fade-in">
    <h3 id="fileModalTitle" class="text-xl font-bold mb-2"></h3>
    <p id="fileModalDesc" class="text-gray-400 mb-3 text-sm"></p>
    <div class="flex items-center text-sm text-gray-500 mb-4">
      <span>上传者: <span id="fileModalUploader"></span></span>
      <span class="mx-2">•</span>
      <span>大小: <span id="fileModalSize"></span></span>
      <span class="mx-2">•</span>
      <span>时间: <span id="fileModalTime"></span></span>
    </div>
    <button id="downloadFile" class="w-full bg-[#0ef] text-[#050810] py-2 rounded hover:brightness-110 mb-2">下载文件</button>
    <button id="shareFile" class="w-full border border-[#0ef] text-[#0ef] py-2 rounded hover:bg-[#0ef]/10 mb-2"><i class="fa fa-share mr-2"></i>分享链接</button>
    <button id="deleteFile" class="w-full border border-red-500 text-red-500 py-2 rounded hover:bg-red-500/10 hidden">删除文件</button>
    <button onclick="hideFileModal()" class="w-full border border-gray-600 text-gray-400 py-2 rounded hover:bg-gray-600/10 mt-2">关闭</button>
  </div>
</div>

<!-- 文件预览模态框 -->
<div id="filePreviewModal" class="fixed inset-0 z-[9999] hidden">
  <div class="absolute inset-0 bg-black/90" onclick="hidePreviewModal()"></div>
  <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-4xl max-h-[90vh] bg-[#050810] cyber-border rounded-lg overflow-hidden fade-in">
    <div class="flex justify-between items-center p-4 border-b border-gray-800">
      <h3 id="previewTitle" class="font-bold text-[#0ef]"></h3>
      <button onclick="hidePreviewModal()" class="text-2xl text-gray-400 hover:text-white">&times;</button>
    </div>
    <div class="p-4 overflow-auto max-h-[calc(90vh-80px)]">
      <img id="previewImage" class="w-full max-h-[70vh] object-contain hidden" alt="图片预览">
      <div id="previewText" class="text-center py-8 hidden">
        <i class="fa fa-file-text-o text-4xl text-gray-400 mb-3"></i>
        <p class="text-gray-400">此文件类型不支持预览，请直接下载</p>
      </div>
    </div>
  </div>
</div>

<footer class="py-8 border-t border-[#0ef]/30 text-center text-sm text-gray-400 bg-[#050810]/50">
  <div class="container px-4">
    <div class="neon text-lg mb-2">INFINITY 无限工作室</div>
    <p class="mb-2">专注视觉小说、人物设定与数字工艺创作</p>
    <p>© 2026 INFINITY STUDIO | 创意不止，未来可期</p>
    <div class="mt-4 flex flex-wrap justify-center gap-4">
      <a href="#home" class="text-gray-400 hover:text-[#0ef] transition">首页</a>
      <a href="#portfolio" class="text-gray-400 hover:text-[#0ef] transition">作品集</a>
      <a href="#install" class="text-gray-400 hover:text-[#0ef] transition">文件中心</a>
      <a href="#forum" class="text-gray-400 hover:text-[#0ef] transition">论坛</a>
      <button onclick="showSection('profilePanel')" class="text-gray-400 hover:text-[#0ef] transition">个人中心</button>
      <!-- 快速跳转按钮（仅登录用户显示） -->
      <span id="quickLinks" class="hidden">
        <button onclick="showSection('install')" class="text-gray-400 hover:text-[#0ef] transition ml-2">上传文件</button>
        <button onclick="showSection('forum')" class="text-gray-400 hover:text-[#0ef] transition ml-2">发布帖子</button>
      </span>
    </div>
    
    <!-- 返回顶部按钮 -->
    <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" 
            class="mt-6 px-4 py-2 border border-[#0ef] text-[#0ef] rounded hover:bg-[#0ef]/10 transition">
      <i class="fa fa-arrow-up mr-2"></i>返回顶部
    </button>
  </div>
</footer>
</div>

<!-- 通知容器 -->
<div id="notificationContainer" class="fixed top-4 right-4 z-[9999] space-y-2"></div>

<!-- 批量操作工具栏 -->
<div id="batchTools" class="fixed bottom-4 left-4 z-40 hidden">
  <div class="cyber-border p-3 bg-black/80 backdrop-blur-sm rounded-lg">
    <div class="flex items-center gap-4">
      <span id="selectedCount" class="text-sm text-[#0ef]">已选择 0 个项目</span>
      <div class="flex gap-2">
        <button onclick="batchDownload()" class="px-3 py-1 bg-[#0ef] text-[#050810] rounded text-sm hover:brightness-110 transition">下载选中</button>
        <button onclick="batchDelete()" class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:brightness-110 transition">删除选中</button>
        <button onclick="cancelBatch()" class="px-3 py-1 bg-gray-600 text-white rounded text-sm hover:brightness-110 transition">取消</button>
      </div>
    </div>
  </div>
</div>

<script>
// ============================================
// 核心配置
// ============================================
const BIN_ID = '6999d55743b1c97be9915f95';
const MASTER_KEY = '$2a$10$aOUbP3q92O7k0VFZ3itapOH0PLWruFFxuXhKHSMYb9XCbrOBeihmm';

// ============================================
// 默认数据
// ============================================
const defaultData = {
  users: [
    {email: 'admin@qq.com', pwd: 'admin123', username: '管理员', role: 'admin'}
  ],
  files: [],
  favorites: {},
  works: [
    {id: '1', title: '智能设备控制界面', cate: 'UI设计', img: 'https://images.unsplash.com/photo-1558655146-9f40138edfeb?w=800&auto=format&fit=crop'},
    {id: '2', title: '科技企业官网', cate: '网页设计', img: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&auto=format&fit=crop'},
    {id: '3', title: '品牌视觉系统', cate: '品牌设计', img: 'https://images.unsplash.com/photo-1561070791-2526d30994b5?w=800&auto=format&fit=crop'}
  ],
  posts: [
    {id: '1', title: '欢迎来到无限创意工作室！', content: '这里是创意分享和交流的空间，欢迎大家积极发帖讨论。', userEmail: 'admin@qq.com', time: new Date().toISOString(), comments: []}
  ],
  currentUser: null
};

// 全局数据
let D = defaultData;
let currentFileId = null;
let selectedFiles = [];

// 主题配置
const themes = {
    cyber: { 
        name: '赛博蓝',
        colors: { primary: '#0ef', secondary: '#f0a', bg: '#050810', text: '#f8fafc' }
    },
    sunset: { 
        name: '落日橙',
        colors: { primary: '#ff6b35', secondary: '#ffa500', bg: '#1a1a2e', text: '#f0f0f0' }
    },
    forest: { 
        name: '极光绿',
        colors: { primary: '#00ff88', secondary: '#00ccff', bg: '#0a1929', text: '#e6f1ff' }
    },
    midnight: { 
        name: '午夜紫',
        colors: { primary: '#9d4edd', secondary: '#ff4d6d', bg: '#10002b', text: '#e0aaff' }
    }
};

// ============================================
// 数据存储与加载
// ============================================
async function loadData() {
  try {
    const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
      headers: {'X-Master-Key': MASTER_KEY}
    });
    const result = await response.json();
    if (result.record) {
      D = result.record;
    }
  } catch (error) {
    console.log('使用默认数据，如需保存请配置JSONBin密钥');
  }
  updateUI();
  
  // 初始化新增功能
  initThemeSwitcher();
  showNotification('网站加载完成', 'success');
}

async function saveData() {
  try {
    await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'X-Master-Key': MASTER_KEY
      },
      body: JSON.stringify(D)
    });
  } catch (error) {
    console.error('保存失败，请检查JSONBin配置');
  }
}

// ============================================
// 工具函数
// ============================================
function showTip(msg, type = 'success') {
  const tip = document.getElementById('loginTip');
  tip.textContent = msg;
  tip.className = 'text-center text-sm mt-3 ' + 
    (type === 'success' ? 'text-green-400' : type === 'error' ? 'text-red-400' : 'text-[#0ef]');
  tip.classList.remove('hidden');
  setTimeout(() => tip.classList.add('hidden'), 2000);
}

// 新增：通知系统
function showNotification(message, type = 'info', duration = 3000) {
    const container = document.getElementById('notificationContainer');
    const notification = document.createElement('div');
    
    const icons = {
        success: 'fa-check-circle',
        error: 'fa-exclamation-circle',
        warning: 'fa-exclamation-triangle',
        info: 'fa-info-circle'
    };
    
    notification.className = `cyber-border px-4 py-3 rounded-lg shadow-lg transform transition-all duration-300 translate-x-0 opacity-0`;
    notification.innerHTML = `
        <div class="flex items-center gap-3">
            <i class="fa ${icons[type] || 'fa-info-circle'} ${type === 'success' ? 'text-green-400' : type === 'error' ? 'text-red-400' : type === 'warning' ? 'text-yellow-400' : 'text-[#0ef]'}"></i>
            <span class="text-sm">${message}</span>
        </div>
    `;
    
    container.appendChild(notification);
    
    // 显示动画
    setTimeout(() => {
        notification.classList.remove('opacity-0');
        notification.classList.add('opacity-100');
    }, 10);
    
    // 自动消失
    setTimeout(() => {
        notification.classList.remove('opacity-100');
        notification.classList.add('opacity-0');
        setTimeout(() => notification.remove(), 300);
    }, duration);
}

function formatTime(dateStr) {
  const date = new Date(dateStr);
  const now = new Date();
  const diff = now - date;
  
  if (diff < 60000) return '刚刚';
  if (diff < 3600000) return Math.floor(diff / 60000) + '分钟前';
  if (date.toDateString() === now.toDateString()) {
    return '今天 ' + date.toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
  }
  return date.toLocaleDateString('zh-CN');
}

function formatSize(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
  return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
}

function getUsername(email) {
  const user = D.users.find(u => u.email === email);
  return user ? (user.username || user.email.split('@')[0]) : email;
}

// ============================================
// 文件功能
// ============================================

// 上传文件
document.getElementById('uploadFile').addEventListener('click', async function() {
  const name = document.getElementById('fileName').value.trim();
  const desc = document.getElementById('fileDesc').value.trim();
  const fileInput = document.getElementById('fileInput');
  
  if (!name) {
    showNotification('请输入文件名称', 'error');
    return;
  }
  
  if (!fileInput.files.length) {
    showNotification('请选择文件', 'error');
    return;
  }
  
  const file = fileInput.files[0];
  if (file.size > 10 * 1024 * 1024) {
    showNotification('文件过大，请上传小于10MB的文件', 'error');
    return;
  }
  
  const reader = new FileReader();
  
  reader.onload = async function(e) {
    const fileData = {
      id: Date.now().toString(),
      name: name,
      desc: desc,
      fileName: file.name,
      fileType: file.type,
      fileSize: file.size,
      uploadTime: new Date().toISOString(),
      uploader: D.currentUser.email,
      base64: e.target.result.split(',')[1]
    };
    
    D.files.unshift(fileData);
    await saveData();
    
    document.getElementById('fileName').value = '';
    document.getElementById('fileDesc').value = '';
    fileInput.value = '';
    
    showNotification('文件上传成功！', 'success');
    renderFiles();
    renderProfile();
  };
  
  reader.readAsDataURL(file);
});

function getFileIcon(fileType) {
  if (fileType.includes('image')) return 'fa-file-image-o';
  if (fileType.includes('pdf')) return 'fa-file-pdf-o';
  if (fileType.includes('zip') || fileType.includes('rar')) return 'fa-file-archive-o';
  if (fileType.includes('word')) return 'fa-file-word-o';
  return 'fa-file-o';
}

// 新增：收藏功能
function toggleFavorite(type, id, element) {
    if (!D.currentUser) {
        showLogin();
        return;
    }
    
    if (!D.favorites) D.favorites = {};
    if (!D.favorites[D.currentUser.email]) D.favorites[D.currentUser.email] = [];
    
    const favorites = D.favorites[D.currentUser.email];
    const index = favorites.findIndex(f => f.type === type && f.id === id);
    
    if (index === -1) {
        favorites.push({type, id, time: new Date().toISOString()});
        if (element) {
            element.innerHTML = '<i class="fa fa-heart text-red-400"></i>';
            element.title = '取消收藏';
        }
        showNotification('已添加到收藏', 'success');
    } else {
        favorites.splice(index, 1);
        if (element) {
            element.innerHTML = '<i class="fa fa-heart-o text-gray-400"></i>';
            element.title = '添加到收藏';
        }
        showNotification('已取消收藏', 'info');
    }
    
    saveData();
}

function isFavorited(type, id) {
    if (!D.currentUser || !D.favorites || !D.favorites[D.currentUser.email]) return false;
    return D.favorites[D.currentUser.email].some(f => f.type === type && f.id === id);
}

// 渲染文件列表（增强版）
function renderFiles() {
  const fileGrid = document.getElementById('fileGrid');
  
  if (!D.files || D.files.length === 0) {
    fileGrid.innerHTML = '<p class="text-center text-gray-400 col-span-3 py-8">还没有文件，上传第一个吧！</p>';
    return;
  }
  
  fileGrid.innerHTML = D.files.map(file => {
    const isFav = D.currentUser ? isFavorited('file', file.id) : false;
    const isSelected = selectedFiles.includes(file.id);
    
    return `
    <div class="p-5 rounded-lg cyber-border bg-black/20 hover:bg-black/30 transition file-item ${isSelected ? 'selected border-[#0ef] bg-[#0ef]/10' : ''}"
         onclick="if(event.target.type !== 'checkbox') viewFile('${file.id}')">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center">
          <input type="checkbox" 
                 class="mr-3 h-4 w-4 rounded border-gray-700 bg-gray-900 text-[#0ef] focus:ring-[#0ef] focus:ring-2"
                 onclick="event.stopPropagation(); toggleFileSelection('${file.id}', this.closest('.file-item'))"
                 ${isSelected ? 'checked' : ''}>
          <i class="fa ${getFileIcon(file.fileType)} text-2xl text-[#0ef] mr-3"></i>
          <div class="flex-1">
            <h4 class="font-bold truncate">${file.name}</h4>
            <p class="text-xs text-gray-400">${getUsername(file.uploader)} • ${formatTime(file.uploadTime)}</p>
          </div>
        </div>
        <div class="flex gap-2">
          <button onclick="event.stopPropagation(); toggleFavorite('file', '${file.id}', this)"
                  class="text-sm" title="${isFav ? '取消收藏' : '添加到收藏'}">
            <i class="fa ${isFav ? 'fa-heart text-red-400' : 'fa-heart-o text-gray-400'}"></i>
          </button>
          <button onclick="event.stopPropagation(); copyShareLink('file', '${file.id}', '${file.name}')"
                  class="text-sm text-gray-400 hover:text-[#0ef]" title="复制分享链接">
            <i class="fa fa-share"></i>
          </button>
        </div>
      </div>
      <p class="text-sm text-gray-300 mb-3 truncate">${file.desc || '无描述'}</p>
      <div class="flex justify-between items-center text-xs text-gray-500">
        <span>${formatSize(file.fileSize)} • ${file.fileType.split('/')[1] || file.fileType}</span>
        <div class="flex gap-2">
          <button onclick="event.stopPropagation(); previewFile('${file.id}')" 
                  class="text-[#0ef] hover:text-[#0ef]/80 transition" title="预览">
            <i class="fa fa-eye"></i>
          </button>
          <button onclick="event.stopPropagation(); navigateTo('install', {fileId: '${file.id}'})" 
                  class="text-[#0ef] hover:text-[#0ef]/80 transition" title="查看详情">
            查看
          </button>
        </div>
      </div>
    </div>
    `;
  }).join('');
}

// 查看文件详情
function viewFile(fileId) {
  const file = D.files.find(f => f.id === fileId);
  if (!file) return;
  
  currentFileId = fileId;
  const modal = document.getElementById('fileModal');
  document.getElementById('fileModalTitle').textContent = file.name;
  document.getElementById('fileModalDesc').textContent = file.desc || '无描述';
  document.getElementById('fileModalUploader').textContent = getUsername(file.uploader);
  document.getElementById('fileModalSize').textContent = formatSize(file.fileSize);
  document.getElementById('fileModalTime').textContent = formatTime(file.uploadTime);
  
  const deleteBtn = document.getElementById('deleteFile');
  const canDelete = D.currentUser && 
    (D.currentUser.email === file.uploader || D.currentUser.role === 'admin');
  deleteBtn.classList.toggle('hidden', !canDelete);
  
  modal.classList.remove('hidden');
}

function hideFileModal() {
  document.getElementById('fileModal').classList.add('hidden');
}

// 下载文件
document.getElementById('downloadFile').addEventListener('click', function() {
  const file = D.files.find(f => f.id === currentFileId);
  if (!file) return;
  
  const link = document.createElement('a');
  link.href = `data:${file.fileType};base64,${file.base64}`;
  link.download = file.fileName || file.name;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  
  showNotification('开始下载', 'success');
});

// 删除文件
document.getElementById('deleteFile').addEventListener('click', async function() {
  if (!confirm('确定删除这个文件吗？此操作不可撤销！')) return;
  
  D.files = D.files.filter(f => f.id !== currentFileId);
  await saveData();
  
  hideFileModal();
  showNotification('文件已删除', 'success');
  renderFiles();
  renderProfile();
  renderAdmin();
});

// 分享文件链接
document.getElementById('shareFile')?.addEventListener('click', function() {
  if (currentFileId) {
    copyShareLink('file', currentFileId);
  }
});

// ============================================
// 新增功能：全局搜索
// ============================================
function initGlobalSearch() {
    const searchInput = document.getElementById('globalSearch');
    const resultsDiv = document.getElementById('searchResults');
    
    if (!searchInput) return;
    
    searchInput.addEventListener('input', function() {
        const keyword = this.value.trim().toLowerCase();
        if (!keyword) {
            resultsDiv.classList.add('hidden');
            return;
        }
        
        const results = {
            files: D.files.filter(f => 
                f.name.toLowerCase().includes(keyword) || 
                f.desc.toLowerCase().includes(keyword)
            ).slice(0, 5),
            posts: D.posts.filter(p => 
                p.title.toLowerCase().includes(keyword) || 
                p.content.toLowerCase().includes(keyword)
            ).slice(0, 5)
        };
        
        if (results.files.length === 0 && results.posts.length === 0) {
            resultsDiv.innerHTML = '<div class="p-4 text-center text-gray-400">未找到相关结果</div>';
        } else {
            resultsDiv.innerHTML = `
                ${results.files.length > 0 ? `
                    <div class="p-3 border-b border-gray-800">
                        <h4 class="text-xs font-bold text-[#0ef] mb-2">文件 (${results.files.length})</h4>
                        ${results.files.map(f => `
                            <div class="flex items-center gap-2 p-2 hover:bg-gray-900 rounded cursor-pointer" onclick="viewFile('${f.id}')">
                                <i class="fa fa-file-o text-[#0ef]"></i>
                                <div class="flex-1">
                                    <div class="text-sm truncate">${f.name}</div>
                                    <div class="text-xs text-gray-500 truncate">${f.desc || '无描述'}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
                ${results.posts.length > 0 ? `
                    <div class="p-3">
                        <h4 class="text-xs font-bold text-[#0ef] mb-2">帖子 (${results.posts.length})</h4>
                        ${results.posts.map(p => `
                            <div class="p-2 hover:bg-gray-900 rounded cursor-pointer" onclick="navigateTo('forum', {postId: '${p.id}'})">
                                <div class="text-sm font-medium truncate">${p.title}</div>
                                <div class="text-xs text-gray-500 truncate">${p.content.substring(0, 50)}${p.content.length > 50 ? '...' : ''}</div>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
            `;
        }
        
        resultsDiv.classList.remove('hidden');
    });
    
    document.addEventListener('click', function(e) {
        if (!searchInput.parentElement.contains(e.target)) {
            resultsDiv.classList.add('hidden');
        }
    });
}

// ============================================
// 新增功能：批量操作
// ============================================
function toggleFileSelection(fileId, element) {
    const index = selectedFiles.indexOf(fileId);
    if (index === -1) {
        selectedFiles.push(fileId);
        if (element) element.classList.add('border-[#0ef]', 'bg-[#0ef]/10');
    } else {
        selectedFiles.splice(index, 1);
        if (element) element.classList.remove('border-[#0ef]', 'bg-[#0ef]/10');
    }
    
    updateBatchTools();
}

function updateBatchTools() {
    const batchTools = document.getElementById('batchTools');
    const selectedCount = document.getElementById('selectedCount');
    
    if (selectedFiles.length > 0) {
        batchTools.classList.remove('hidden');
        selectedCount.textContent = `已选择 ${selectedFiles.length} 个文件`;
    } else {
        batchTools.classList.add('hidden');
    }
}

function batchDownload() {
    if (selectedFiles.length === 0) {
        showNotification('请先选择文件', 'warning');
        return;
    }
    
    showNotification(`开始批量下载 ${selectedFiles.length} 个文件`, 'info');
    
    selectedFiles.forEach((fileId, index) => {
        setTimeout(() => {
            const file = D.files.find(f => f.id === fileId);
            if (file) {
                const link = document.createElement('a');
                link.href = `data:${file.fileType};base64,${file.base64}`;
                link.download = file.fileName || file.name;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }, index * 500);
    });
    
    selectedFiles = [];
    updateBatchTools();
    document.querySelectorAll('.file-item.selected').forEach(el => {
        el.classList.remove('selected', 'border-[#0ef]', 'bg-[#0ef]/10');
    });
}

function batchDelete() {
    if (selectedFiles.length === 0) {
        showNotification('请先选择文件', 'warning');
        return;
    }
    
    if (!confirm(`确定要删除这 ${selectedFiles.length} 个文件吗？此操作不可撤销！`)) {
        return;
    }
    
    D.files = D.files.filter(f => !selectedFiles.includes(f.id));
    saveData();
    
    showNotification(`成功删除 ${selectedFiles.length} 个文件`, 'success');
    
    selectedFiles = [];
    updateBatchTools();
    renderFiles();
    renderAdmin();
}

function cancelBatch() {
    selectedFiles = [];
    updateBatchTools();
    document.querySelectorAll('.file-item.selected').forEach(el => {
        el.classList.remove('selected', 'border-[#0ef]', 'bg-[#0ef]/10');
    });
}

// ============================================
// 新增功能：主题切换
// ============================================
function initThemeSwitcher() {
    const savedTheme = localStorage.getItem('siteTheme') || 'cyber';
    setTheme(savedTheme);
}

function setTheme(themeName) {
    const theme = themes[themeName];
    if (!theme) return;
    
    const root = document.documentElement;
    root.style.setProperty('--color-primary', theme.colors.primary);
    root.style.setProperty('--color-secondary', theme.colors.secondary);
    root.style.setProperty('--color-bg', theme.colors.bg);
    root.style.setProperty('--color-text', theme.colors.text);
    
    document.querySelectorAll('.theme-option').forEach(btn => {
        btn.classList.remove('border-[#0ef]', 'bg-[#0ef]/10');
        if (btn.dataset.theme === themeName) {
            btn.classList.add('border-[#0ef]', 'bg-[#0ef]/10');
        }
    });
    
    localStorage.setItem('siteTheme', themeName);
    showNotification(`已切换到${theme.name}主题`, 'success');
}

// ============================================
// 新增功能：文件预览
// ============================================
function previewFile(fileId) {
    const file = D.files.find(f => f.id === fileId);
    if (!file) return;
    
    const modal = document.getElementById('filePreviewModal');
    const previewImage = document.getElementById('previewImage');
    const previewText = document.getElementById('previewText');
    const previewTitle = document.getElementById('previewTitle');
    
    previewTitle.textContent = file.name;
    
    if (file.fileType.startsWith('image/')) {
        previewImage.src = `data:${file.fileType};base64,${file.base64}`;
        previewImage.classList.remove('hidden');
        previewText.classList.add('hidden');
    } else if (file.fileType.includes('pdf') || file.fileType.includes('text')) {
        previewImage.classList.add('hidden');
        previewText.classList.remove('hidden');
        previewText.innerHTML = `
            <i class="fa fa-${file.fileType.includes('pdf') ? 'file-pdf-o' : 'file-text-o'} text-4xl text-[#0ef] mb-3"></i>
            <p class="text-gray-400 mb-4">此文件类型不支持预览</p>
            <button onclick="downloadFile('${file.id}')" class="px-4 py-2 bg-[#0ef] text-[#050810] rounded hover:brightness-110 transition">
                <i class="fa fa-download mr-2"></i>下载文件
            </button>
        `;
    } else {
        previewImage.classList.add('hidden');
        previewText.classList.remove('hidden');
        previewText.innerHTML = `
            <i class="fa fa-file-o text-4xl text-gray-400 mb-3"></i>
            <p class="text-gray-400 mb-2">${file.fileName}</p>
            <p class="text-sm text-gray-500 mb-4">${formatSize(file.fileSize)} • ${file.fileType}</p>
            <button onclick="downloadFile('${file.id}')" class="px-4 py-2 bg-[#0ef] text-[#050810] rounded hover:brightness-110 transition">
                <i class="fa fa-download mr-2"></i>下载文件
            </button>
        `;
    }
    
    modal.classList.remove('hidden');
}

function hidePreviewModal() {
    document.getElementById('filePreviewModal').classList.add('hidden');
}

function downloadFile(fileId) {
    const file = D.files.find(f => f.id === fileId);
    if (!file) return;
    
    const link = document.createElement('a');
    link.href = `data:${file.fileType};base64,${file.base64}`;
    link.download = file.fileName || file.name;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    showNotification('开始下载文件', 'success');
    hidePreviewModal();
}

// ============================================
// 新增功能：数据统计面板
// ============================================
function createStatsPanel() {
    const statsHTML = `
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div class="cyber-border p-4 text-center bg-black/20 hover:bg-black/30 transition">
            <div class="text-2xl font-bold text-[#0ef]">${D.users.length}</div>
            <div class="text-sm text-gray-400">总用户</div>
        </div>
        <div class="cyber-border p-4 text-center bg-black/20 hover:bg-black/30 transition">
            <div class="text-2xl font-bold text-[#0ef]">${D.files.length}</div>
            <div class="text-sm text-gray-400">总文件</div>
            <div class="text-xs text-gray-500 mt-1">${(D.files.reduce((sum, f) => sum + f.fileSize, 0) / (1024 * 1024)).toFixed(1)} MB</div>
        </div>
        <div class="cyber-border p-4 text-center bg-black/20 hover:bg-black/30 transition">
            <div class="text-2xl font-bold text-[#0ef]">${D.posts.length}</div>
            <div class="text-sm text-gray-400">总帖子</div>
        </div>
        <div class="cyber-border p-4 text-center bg-black/20 hover:bg-black/30 transition">
            <div class="text-2xl font-bold text-[#0ef]">${D.posts.reduce((sum, p) => sum + (p.comments ? p.comments.length : 0), 0)}</div>
            <div class="text-sm text-gray-400">总评论</div>
        </div>
    </div>
    `;
    
    const adminPanel = document.querySelector('#adminPanel > .container');
    if (adminPanel) {
        const existingStats = document.querySelector('#adminStats');
        if (existingStats) existingStats.remove();
        
        const statsDiv = document.createElement('div');
        statsDiv.id = 'adminStats';
        statsDiv.innerHTML = statsHTML;
        adminPanel.insertBefore(statsDiv, adminPanel.firstChild);
    }
}

// ============================================
// 新增功能：增强的分享功能
// ============================================
function generateShareLink(type, id, title = '') {
    const baseUrl = window.location.origin + window.location.pathname;
    let shareText = '';
    
    switch(type) {
        case 'file':
            const file = D.files.find(f => f.id === id);
            shareText = title || `分享文件：${file ? file.name : ''}`;
            return `${baseUrl}#install?fileId=${id}`;
        case 'post':
            const post = D.posts.find(p => p.id === id);
            shareText = title || `分享帖子：${post ? post.title : ''}`;
            return `${baseUrl}#forum?postId=${id}`;
        default:
            shareText = '分享自 INFINITY 无限工作室';
            return baseUrl;
    }
}

function copyShareLink(type, id, title = '') {
    const link = generateShareLink(type, id, title);
    
    navigator.clipboard.writeText(link).then(() => {
        showNotification('分享链接已复制到剪贴板', 'success');
    }).catch(() => {
        const textarea = document.createElement('textarea');
        textarea.value = link;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        showNotification('分享链接已复制', 'success');
    });
}

// ============================================
// 论坛功能
// ============================================
function renderPosts() {
  const postList = document.getElementById('postList');
  const noPosts = document.getElementById('noPosts');
  
  if (!D.posts || D.posts.length === 0) {
    postList.innerHTML = '';
    noPosts.classList.remove('hidden');
    return;
  }
  
  noPosts.classList.add('hidden');
  postList.innerHTML = D.posts.map(post => {
    const isFav = D.currentUser ? isFavorited('post', post.id) : false;
    
    return `
    <div class="border-b border-gray-800 pb-4 mb-4 last:border-0">
      <div class="flex justify-between items-start mb-2">
        <h4 class="font-bold text-lg text-[#0ef] cursor-pointer hover:underline" onclick="toggleComments('${post.id}')">${post.title}</h4>
        <div class="flex items-center gap-2">
          <button onclick="event.stopPropagation(); toggleFavorite('post', '${post.id}', this)"
                  class="text-sm" title="${isFav ? '取消收藏' : '添加到收藏'}">
            <i class="fa ${isFav ? 'fa-heart text-red-400' : 'fa-heart-o text-gray-400'}"></i>
          </button>
          ${D.currentUser && (D.currentUser.email === post.userEmail || D.currentUser.role === 'admin') ? `
            <button onclick="deletePost('${post.id}')" class="text-xs text-red-400 hover:text-red-300">删除</button>
          ` : ''}
        </div>
      </div>
      <div class="text-gray-300 mb-2">${post.content}</div>
      <div class="flex justify-between text-xs text-gray-500">
        <span>${getUsername(post.userEmail)} • ${formatTime(post.time)}</span>
        <span>评论 (${post.comments ? post.comments.length : 0})</span>
      </div>
      <div id="comments-${post.id}" class="mt-3 hidden">
        <div class="mb-3 space-y-2" id="comment-list-${post.id}">
          ${post.comments && post.comments.length ? 
            post.comments.map(comment => `
              <div class="border-l-2 border-[#0ef]/30 pl-3 py-1">
                <div class="flex justify-between text-xs">
                  <span class="text-[#0ef]">${getUsername(comment.user)}</span>
                  <span class="text-gray-500">${formatTime(comment.time)}</span>
                </div>
                <div class="text-sm mt-1">${comment.content}</div>
              </div>
            `).join('') : 
            '<p class="text-gray-500 text-sm text-center py-2">暂无评论</p>'
          }
        </div>
        <div class="flex gap-2">
          <input id="comment-input-${post.id}" 
                 placeholder="${D.currentUser ? '写下评论...' : '登录后评论'}" 
                 class="flex-1 bg-gray-900 border border-gray-700 rounded px-3 py-1 text-sm"
                 ${!D.currentUser ? 'readonly style="cursor:not-allowed;"' : ''}>
          <button onclick="${D.currentUser ? `sendComment('${post.id}')` : 'showLogin()'}" 
                  class="${D.currentUser ? 'bg-[#0ef] text-[#050810]' : 'bg-gray-700 text-gray-400'} px-3 py-1 rounded text-sm">
            ${D.currentUser ? '发送' : '登录'}
          </button>
        </div>
      </div>
    </div>
    `;
  }).join('');
}

// 发表帖子
document.getElementById('sendPost').addEventListener('click', async function() {
  const title = document.getElementById('postTitle').value.trim();
  const content = document.getElementById('postContent').value.trim();
  
  if (!title || !content) {
    showNotification('请填写标题和内容', 'error');
    return;
  }
  
  const newPost = {
    id: Date.now().toString(),
    title: title,
    content: content,
    userEmail: D.currentUser.email,
    time: new Date().toISOString(),
    comments: []
  };
  
  D.posts.unshift(newPost);
  await saveData();
  
  document.getElementById('postTitle').value = '';
  document.getElementById('postContent').value = '';
  
  showNotification('帖子发布成功！', 'success');
  renderPosts();
});

// 删除帖子
async function deletePost(postId) {
  if (!confirm('确定删除这个帖子吗？此操作不可撤销！')) return;
  
  D.posts = D.posts.filter(p => p.id !== postId);
  await saveData();
  showNotification('帖子已删除', 'success');
  renderPosts();
}

// 显示/隐藏评论
function toggleComments(postId) {
  const comments = document.getElementById(`comments-${postId}`);
  comments.classList.toggle('hidden');
}

// 发送评论
async function sendComment(postId) {
  const input = document.getElementById(`comment-input-${postId}`);
  const content = input.value.trim();
  
  if (!content) {
    showNotification('评论内容不能为空', 'error');
    return;
  }
  
  const post = D.posts.find(p => p.id === postId);
  if (!post.comments) post.comments = [];
  
  post.comments.push({
    user: D.currentUser.email,
    content: content,
    time: new Date().toISOString()
  });
  
  await saveData();
  input.value = '';
  showNotification('评论已发布', 'success');
  renderPosts();
}

// ============================================
// 作品集
// ============================================
function renderPortfolio() {
  const grid = document.getElementById('portfolioGrid');
  grid.innerHTML = D.works.map(work => `
    <div class="rounded-lg overflow-hidden cyber-border bg-black/20 hover:bg-black/30 transition">
      <img src="${work.img}" class="w-full h-48 object-cover img-scale" alt="${work.title}">
      <div class="p-4">
        <h3 class="font-bold mb-1">${work.title}</h3>
        <span class="text-xs bg-[#0ef]/10 text-[#0ef] px-2 py-1 rounded">${work.cate}</span>
      </div>
    </div>
  `).join('');
}

// ============================================
// 个人中心
// ============================================
function renderProfile() {
  if (!D.currentUser) return;
  
  const user = D.currentUser;
  document.getElementById('usernameInput').value = user.username || '';
  
  const myFiles = D.files.filter(f => f.uploader === user.email);
  document.getElementById('myFileCount').textContent = `(${myFiles.length}个)`;
  
  const myFilesList = document.getElementById('myFiles');
  myFilesList.innerHTML = myFiles.length ? myFiles.map(file => `
    <div class="flex justify-between items-center border-b border-gray-800 py-2">
      <div class="truncate flex-1 mr-2 cursor-pointer" onclick="viewFile('${file.id}')">
        <div class="font-medium">${file.name}</div>
        <div class="text-xs text-gray-500">${formatTime(file.uploadTime)} • ${formatSize(file.fileSize)}</div>
      </div>
      <button onclick="deleteMyFile('${file.id}')" class="text-xs text-red-400 px-2 py-1">删除</button>
    </div>
  `).join('') : '<p class="text-gray-400 text-sm text-center py-4">你还没有上传文件</p>';
}

async function deleteMyFile(fileId) {
  if (!confirm('确定删除这个文件吗？')) return;
  
  D.files = D.files.filter(f => f.id !== fileId);
  await saveData();
  showNotification('文件已删除', 'success');
  renderFiles();
  renderProfile();
}

// 保存用户名
document.getElementById('saveUsername').addEventListener('click', async function() {
  const username = document.getElementById('usernameInput').value.trim();
  
  if (!username) {
    showNotification('请输入用户名', 'error');
    return;
  }
  
  const user = D.users.find(u => u.email === D.currentUser.email);
  if (user) {
    user.username = username;
    D.currentUser.username = username;
    await saveData();
    showNotification('用户名已更新', 'success');
    updateUI();
    renderPosts();
  }
});

// ============================================
// 后台管理
// ============================================
function renderAdmin() {
  createStatsPanel();
  
  document.getElementById('userCount').textContent = D.users.length;
  document.getElementById('fileCount').textContent = D.files.length;
  
  const userList = document.getElementById('adminUserList');
  userList.innerHTML = D.users.map(user => `
    <div class="flex justify-between items-center border-b border-gray-800 py-2">
      <div class="truncate flex-1 mr-2">
        <div class="font-medium">${user.username || user.email.split('@')[0]}</div>
        <div class="text-xs text-gray-500">${user.email} • ${user.role === 'admin' ? '管理员' : '普通用户'}</div>
      </div>
      <div class="flex gap-2">
        ${user.role !== 'admin' ? `
          <button onclick="promoteUser('${user.email}')" class="text-xs text-[#0ef] px-2 py-1">设为管理</button>
          <button onclick="deleteUser('${user.email}')" class="text-xs text-red-400 px-2 py-1">删除</button>
        ` : '<span class="text-xs text-gray-500">系统管理</span>'}
      </div>
    </div>
  `).join('');
  
  const fileList = document.getElementById('adminFileList');
  fileList.innerHTML = D.files.map(file => `
    <div class="flex justify-between items-center border-b border-gray-800 py-2">
      <div class="truncate flex-1 mr-2">
        <div class="font-medium">${file.name}</div>
        <div class="text-xs text-gray-500">${getUsername(file.uploader)} • ${formatTime(file.uploadTime)}</div>
      </div>
      <button onclick="deleteFileAdmin('${file.id}')" class="text-xs text-red-400 px-2 py-1">删除</button>
    </div>
  `).join('');
}

async function deleteUser(email) {
  if (!confirm('确定删除这个用户吗？该用户的所有帖子和文件将被保留。')) return;
  
  D.users = D.users.filter(u => u.email !== email);
  await saveData();
  showNotification('用户已删除', 'success');
  renderAdmin();
}

async function promoteUser(email) {
  const user = D.users.find(u => u.email === email);
  if (user) {
    user.role = 'admin';
    await saveData();
    showNotification('已设为管理员', 'success');
    renderAdmin();
  }
}

async function deleteFileAdmin(fileId) {
  if (!confirm('确定删除这个文件吗？')) return;
  
  D.files = D.files.filter(f => f.id !== fileId);
  await saveData();
  showNotification('文件已删除', 'success');
  renderFiles();
  renderAdmin();
}

// ============================================
// 登录注册功能
// ============================================
function showLogin() {
  document.getElementById('loginModal').classList.remove('hidden');
}

function hideLogin() {
  document.getElementById('loginModal').classList.add('hidden');
}

// 登录
document.getElementById('loginBtn').addEventListener('click', async function() {
  const email = document.getElementById('emailInput').value.trim();
  const pwd = document.getElementById('pwdInput').value.trim();
  
  if (!email || !pwd) {
    showNotification('请输入邮箱和密码', 'error');
    return;
  }
  
  const user = D.users.find(u => u.email === email && u.pwd === pwd);
  if (!user) {
    showNotification('邮箱或密码错误', 'error');
    return;
  }
  
  D.currentUser = {email: user.email, role: user.role, username: user.username};
  await saveData();
  
  document.getElementById('emailInput').value = '';
  document.getElementById('pwdInput').value = '';
  
  hideLogin();
  updateUI();
  showNotification('登录成功！', 'success');
});

// 注册
document.getElementById('regBtn').addEventListener('click', async function() {
  const email = document.getElementById('emailInput').value.trim();
  const pwd = document.getElementById('pwdInput').value.trim();
  
  if (!email || !pwd) {
    showNotification('请输入邮箱和密码', 'error');
    return;
  }
  
  if (!email.includes('@') || !email.includes('.')) {
    showNotification('请输入有效的邮箱', 'error');
    return;
  }
  
  if (pwd.length < 6) {
    showNotification('密码至少6位', 'error');
    return;
  }
  
  if (D.users.some(u => u.email === email)) {
    showNotification('邮箱已注册', 'error');
    return;
  }
  
  const newUser = {
    email: email,
    pwd: pwd,
    username: email.split('@')[0],
    role: 'user'
  };
  
  D.users.push(newUser);
  D.currentUser = {email: newUser.email, role: 'user', username: newUser.username};
  await saveData();
  
  document.getElementById('emailInput').value = '';
  document.getElementById('pwdInput').value = '';
  
  hideLogin();
  updateUI();
  showNotification('注册成功，已自动登录！', 'success');
});

// ============================================
// 页面跳转功能
// ============================================
function navigateTo(sectionId, params = {}) {
    showSection(sectionId);
    
    let hash = `#${sectionId}`;
    if (Object.keys(params).length > 0) {
        const query = new URLSearchParams(params).toString();
        hash += `?${query}`;
    }
    window.history.pushState({}, '', hash);
    
    if (sectionId === 'install' && params.fileId) {
        setTimeout(() => viewFile(params.fileId), 100);
    }
    if (sectionId === 'forum' && params.postId) {
        setTimeout(() => toggleComments(params.postId), 100);
    }
}

function handleUrlParams() {
    const hash = window.location.hash;
    if (!hash) return;
    
    const [section, query] = hash.substring(1).split('?');
    const params = query ? Object.fromEntries(new URLSearchParams(query)) : {};
    
    if (document.getElementById(section)) {
        showSection(section);
        
        if (section === 'install' && params.fileId) {
            viewFile(params.fileId);
        }
        if (section === 'forum' && params.postId) {
            toggleComments(params.postId);
        }
    }
}

// ============================================
// 界面更新与导航
// ============================================
function updateUI() {
  const user = D.currentUser;
  
  const loginBtn = document.getElementById('loginToggle');
  const mobileLogin = document.getElementById('mobileLogin');
  const profileBtn = document.getElementById('profileBtn');
  const mobileProfile = document.getElementById('mobileProfile');
  const adminBtn = document.getElementById('adminBtn');
  const mobileAdmin = document.getElementById('mobileAdmin');
  
  if (user) {
    const displayName = user.username || user.email.split('@')[0];
    loginBtn.textContent = `退出 (${displayName})`;
    mobileLogin.textContent = `退出 (${displayName})`;
    profileBtn.classList.remove('hidden');
    mobileProfile.classList.remove('hidden');
    
    document.getElementById('uploadArea').classList.remove('hidden');