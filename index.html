<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>无限工作室 | INFINITY STUDIO</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script>
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      colors: {
        primary: '#0ef',
        secondary: '#f0a',
        dark: '#050810',
        light: '#f8fafc'
      },
      fontFamily: {
        cyber: ['Orbitron', 'sans-serif']
      }
    }
  }
}
</script>
<style type="text/tailwindcss">
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap');
@layer utilities {
  .scroll-smooth { scroll-behavior: smooth; }
  .glass { background: rgba(5,8,16,0.85); backdrop-filter: blur(16px); }
  .img-scale { transition: transform 0.4s ease; }
  .img-scale:hover { transform: scale(1.08); }
  .fade-in { animation: fadeIn 0.5s ease forwards; }
  .slide-up { animation: slideUp 0.5s ease forwards; }

  /* 全屏扫描线 */
  .scan-line {
    position: relative;
    overflow: hidden;
  }
  .scan-line::after {
    content: '';
    position: absolute;
    top: -100%;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, transparent 0%, rgba(0,238,255,0.08) 50%, transparent 100%);
    animation: scan 5s linear infinite;
  }

  /* 四周霓虹故障边框 */
  .cyber-error-border {
    position: relative;
    z-index: 1;
  }
  .cyber-error-border::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    border: 2px solid rgba(0,238,255,0.2);
    box-shadow: 0 0 25px rgba(0,238,255,0.15);
    pointer-events: none;
    z-index: 9998;
    animation: borderGlitch 3s infinite alternate ease-in-out;
  }
  @keyframes borderGlitch {
    0% { border-color: rgba(0,238,255,0.2); box-shadow: 0 0 25px rgba(0,238,255,0.15); }
    50% { border-color: rgba(255,0,170,0.25); box-shadow: 0 0 35px rgba(255,0,170,0.2); }
    100% { border-color: rgba(0,238,255,0.2); box-shadow: 0 0 25px rgba(0,238,255,0.15); }
  }

  /* 霓虹呼吸 */
  .neon {
    color: #00cccc;
    font-weight: 700;
    opacity: 0.9;
    animation: neon 3s infinite alternate ease-in-out;
  }
  @keyframes neon {
    0%  { text-shadow: 0 0 8px rgba(0,238,255,0.4), 0 0 16px rgba(0,238,255,0.25); opacity: 0.85; }
    100%{ text-shadow: 0 0 12px rgba(0,238,255,0.6), 0 0 24px rgba(0,238,255,0.35); opacity: 0.95; }
  }

  /* 赛博故障 */
  .glitch {
    position: relative;
  }
  .glitch::before {
    content: attr(data-text);
    position: absolute;
    left: 0; top: 0;
    width: 100%; height: 100%;
    color: #f0a;
    opacity: 0.4;
    animation: glitch 2.8s infinite alternate-reverse;
  }
  @keyframes glitch {
    0%  { transform: translate(0, 0); }
    15% { transform: translate(1px, 1px); }
    35% { transform: translate(-1px, -1px); }
    50% { transform: translate(0, 0); }
    65% { transform: translate(1px, -1px); }
    85% { transform: translate(-1px, 1px); }
    100%{ transform: translate(0, 0); }
  }

  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes slideUp { from { opacity:0; transform: translateY(30px); } to { opacity:1; transform: translateY(0); } }
  @keyframes scan {
    0% { top: -100%; }
    100% { top: 100%; }
  }
  .carousel-item { display: none; }
  .carousel-item.active { display: block; animation: fadeIn 0.8s ease; }

  .cyber-border {
    border: 1px solid rgba(0,238,255,0.3);
    box-shadow: 0 0 12px rgba(0,238,255,0.15);
  }
  .cyber-card:hover {
    box-shadow: 0 0 20px rgba(0,238,255,0.25);
    transform: translateY(-5px);
    transition: all 0.3s ease;
  }
}
</style>
</head>
<body class="bg-dark text-light antialiased cyber-error-border">
<div id="app" class="min-h-screen flex flex-col">

<!-- 导航 -->
<nav class="fixed w-full z-50 glass border-b border-primary/40 transition-all duration-300">
  <div class="container mx-auto px-4 py-3 flex items-center justify-between">
    <a href="#home" class="text-xl font-bold text-white neon font-cyber">INFINITY 无限</a>
    <div class="hidden md:flex gap-5 items-center">
      <a href="#home" class="hover:text-primary transition-colors">首页</a>
      <a href="#portfolio" class="hover:text-primary transition-colors">作品集</a>
      <a href="#install" class="hover:text-primary transition-colors">下载作品</a>
      <a href="#team" class="hover:text-primary transition-colors">团队</a>
      <a href="#forum" class="hover:text-primary transition-colors">论坛</a>
      <button id="themeBtn" class="px-3 py-1 rounded bg-gray-900 text-sm hover:brightness-125 transition"></button>
      <button id="adminBtn" class="px-3 py-1 rounded bg-secondary text-white text-sm hover:brightness-125 transition hidden">管理</button>
      <button id="loginToggle" class="px-4 py-2 rounded bg-primary text-dark font-medium hover:brightness-110 transition">登录</button>
    </div>
    <button class="md:hidden text-xl" id="menuBtn"><i class="fa fa-bars"></i></button>
  </div>
</nav>

<!-- 移动端菜单 -->
<div id="mobileMenu" class="fixed top-16 left-0 right-0 glass hidden border-b border-primary/30 z-40">
  <div class="container px-4 py-3 flex flex-col gap-3">
    <a href="#home" class="py-2 hover:text-primary">首页</a>
    <a href="#portfolio" class="py-2 hover:text-primary">作品集</a>
    <a href="#install" class="py-2 hover:text-primary">下载作品</a>
    <a href="#team" class="py-2 hover:text-primary">团队</a>
    <a href="#forum" class="py-2 hover:text-primary">论坛</a>
    <button id="mobileTheme" class="py-2 bg-gray-900 rounded text-sm"></button>
    <button id="mobileAdmin" class="py-2 bg-secondary text-white rounded text-sm hidden">管理</button>
    <button id="mobileLogin" class="py-2 bg-primary text-dark rounded">登录</button>
  </div>
</div>

<main class="flex-1 pt-16">
<!-- 首页轮播 -->
<section id="home" class="relative min-h-[90vh] flex items-center justify-center overflow-hidden scan-line">
  <div class="absolute inset-0 bg-gradient-to-b from-dark via-dark/90 to-dark z-0"></div>
  <div class="absolute inset-0 bg-[url('https://i.ibb.co/r2kB5zgP/wx.png')] opacity-10 bg-cover bg-center z-0"></div>
  <div class="carousel relative z-10 container px-4 text-center max-w-4xl">
    <div class="carousel-item active fade-in">
      <h1 class="text-4xl md:text-7xl font-bold text-white neon slide-up glitch" data-text="无限创意设计">无限创意设计</h1>
      <p class="mt-6 text-gray-300 text-lg slide-up delay-100">专注视觉小说,人物设定,数字工艺 | 赛博朋克创作工作室</p>
    </div>
    <div class="carousel-item fade-in">
      <h1 class="text-4xl md:text-7xl font-bold text-white neon slide-up glitch" data-text="创意交流社区">创意交流社区</h1>
      <p class="mt-6 text-gray-300 text-lg slide-up delay-100">分享灵感，共同成长 | 未来科技美学</p>
    </div>
    <div class="carousel-item fade-in">
      <h1 class="text-4xl md:text-7xl font-bold text-white neon slide-up glitch" data-text="即刻加入我们">即刻加入我们</h1>
      <p class="mt-6 text-gray-300 text-lg slide-up delay-100">无限可能，由你创造</p>
    </div>
    <div class="absolute bottom-8 left-1/2 -translate-x-1/2 flex gap-3 z-10">
      <button class="carousel-dot w-3 h-3 rounded-full bg-primary"></button>
      <button class="carousel-dot w-3 h-3 rounded-full bg-primary/30"></button>
      <button class="carousel-dot w-3 h-3 rounded-full bg-primary/30"></button>
    </div>
    <div class="mt-8 flex flex-wrap justify-center gap-10 slide-up delay-200">
      <a href="#portfolio" class="px-8 py-3 bg-primary text-dark rounded hover:brightness-110 transition uppercase tracking-wider">浏览作品</a>
      <a href="#forum" class="px-6 py-3 border border-primary text-primary rounded hover:bg-primary/10 transition uppercase tracking-wider">加入讨论</a>
    </div>
  </div>
</section>

<!-- 作品安装包中心 -->
<section id="install" class="py-20 bg-dark fade-in">
  <div class="container mx-auto px-4 max-w-5xl">
    <h2 class="text-4xl font-bold text-center mb-3 neon font-cyber glitch" data-text="作品安装包中心">作品安装包中心</h2>
    <p class="text-center text-gray-400 mb-12 text-lg">上传 / 下载项目源文件、安装包、工程文件</p>
    <p class="text-center text-gray-400 mb-12 text-lg">仅管理员可用</p>

    <div id="uploadArea" class="hidden mb-10 p-6 rounded-xl cyber-border bg-black/30">
      <h3 class="text-xl font-bold mb-4 text-primary"><i class="fa fa-cloud-upload mr-2"></i>管理员上传安装包</h3>
      <input id="packageName" placeholder="安装包名称" class="w-full bg-gray-900 border border-gray-700 rounded px-4 py-3 mb-3">
      <input id="packageDesc" placeholder="简介说明" class="w-full bg-gray-900 border border-gray-700 rounded px-4 py-3 mb-3">
      <!-- 修改：将文件输入框改为文本输入框，用于输入网络直链 -->
      <input id="packageFileUrl" placeholder="安装包的网络直链 (URL)" class="w-full bg-gray-900 border border-gray-700 rounded px-4 py-3 mb-3">
      <button id="uploadPackage" class="w-full bg-primary text-dark py-3 rounded hover:brightness-110 transition uppercase tracking-wider">上传安装包</button>
    </div>

    <div id="packageGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    </div>
  </div>
</section>

<!-- 作品集 -->
<section id="portfolio" class="py-16 bg-black/30 fade-in">
  <div class="container mx-auto px-4">
    <h2 class="text-3xl font-bold text-center mb-3 neon">精选作品集</h2>
    <p class="text-center text-gray-400 mb-8">点击可预览大图 & 单独下载</p>
    <div class="flex flex-col md:flex-row gap-3 justify-center mb-8">
      <input id="searchWork" placeholder="搜索作品..." class="px-4 py-2 rounded bg-gray-900 border border-gray-700 max-w-md w-full">
      <div class="flex gap-2 flex-wrap justify-center">
        <button data-cate="all" class="cate-btn px-3 py-2 rounded bg-primary text-dark">全部</button>
        <button data-cate="UI设计" class="cate-btn px-3 py-2 rounded bg-gray-800">UI设计</button>
        <button data-cate="网页设计" class="cate-btn px-3 py-2 rounded bg-gray-800">网页设计</button>
        <button data-cate="品牌设计" class="cate-btn px-3 py-2 rounded bg-gray-800">品牌设计</button>
      </div>
    </div>
    <div id="portfolioGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    </div>
  </div>
</section>

<!-- 团队 -->
<section id="team" class="py-16 bg-dark fade-in">
  <div class="container px-4">
    <h2 class="text-3xl font-bold text-center mb-12 neon">专业团队</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      <div class="p-6 cyber-border rounded-lg text-center bg-black/10 slide-up cyber-card">
        <img src="https://i.ibb.co/7db3SJzy/kl.jpg" class="w-28 h-28 rounded-full mx-auto object-cover border-2 border-primary" alt="鴋子">
        <h3 class="mt-4 font-bold text-lg">鴋子</h3>
        <p class="text-primary text-sm">创意提供</p>
      </div>
      <div class="p-6 cyber-border rounded-lg text-center bg-black/10 slide-up delay-100 cyber-card">
        <img src="https://i.ibb.co/ccrj1YXL/hs.jpg" class="w-28 h-28 rounded-full mx-auto object-cover border-2 border-primary" alt="霍斯">
        <h3 class="mt-4 font-bold text-lg">霍斯</h3>
        <p class="text-primary text-sm">文集综合</p>
      </div>
      <div class="p-6 cyber-border rounded-lg text-center bg-black/10 slide-up delay-200 cyber-card">
        <img src="https://i.ibb.co/C371q84q/kg.jpg" class="w-28 h-28 rounded-full mx-auto object-cover border-2 border-primary" alt="King_-G">
        <h3 class="mt-4 font-bold text-lg">King_-G</h3>
        <p class="text-primary text-sm">网页开发</p>
      </div>
      <div class="p-6 cyber-border rounded-lg text-center bg-black/10 slide-up delay-300 cyber-card">
        <img src="https://i.ibb.co/WW5W6qgB/lx.png" class="w-28 h-28 rounded-full mx-auto object-cover border-2 border-primary" alt="洛小">
        <h3 class="mt-4 font-bold text-lg">洛小</h3>
        <p class="text-primary text-sm">审核</p>
      </div>
    </div>
  </div>
</section>

<!-- 论坛 -->
<section id="forum" class="py-16 bg-black/30 fade-in">
  <div class="container px-4 max-w-5xl">
    <h2 class="text-3xl font-bold text-center mb-8 neon">创意论坛</h2>
    <div class="grid md:grid-cols-3 gap-8">
      <div class="md:col-span-1">
        <div class="cyber-border rounded-lg p-5 bg-black/20 sticky top-24">
          <h3 class="font-bold mb-4 text-primary">发布话题</h3>
          <div id="postArea" class="hidden">
            <input id="postTitle" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 mb-3" placeholder="标题" maxlength="100">
            <textarea id="postContent" rows="4" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 mb-3" placeholder="内容" maxlength="1000"></textarea>
            <div class="flex gap-2">
              <button id="sendPost" class="flex-1 bg-primary text-dark py-2 rounded hover:brightness-110 transition">发布</button>
              <button id="clearPost" class="px-4 bg-gray-800 text-gray-300 py-2 rounded hover:bg-gray-700 transition">清空</button>
            </div>
            <div class="text-xs text-gray-500 mt-2 text-right">
              <span id="charCount">0/1000</span>
            </div>
          </div>
          <div id="needLogin" class="text-center text-gray-400 py-4">
            <p class="mb-2">请先登录以发布话题</p>
            <button onclick="showLogin()" class="px-4 py-2 bg-primary text-dark rounded hover:brightness-110 transition">立即登录</button>
          </div>
        </div>
      </div>
      <div class="md:col-span-2">
        <div class="cyber-border rounded-lg p-5 bg-black/20">
          <div class="flex justify-between items-center mb-4">
            <h3 class="font-bold text-primary">最新帖子</h3>
            <div class="text-sm text-gray-400" id="postCount">0个帖子</div>
          </div>
          <div id="postList" class="space-y-4"></div>
          <div id="noPosts" class="text-center text-gray-400 py-8 hidden">
            <i class="fa fa-comments-o text-4xl mb-3"></i>
            <p>暂无帖子，成为第一个发布话题的人吧！</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- 后台管理 -->
<section id="adminPanel" class="py-16 hidden">
  <div class="container px-4 max-w-5xl">
    <h2 class="text-3xl font-bold text-center mb-8 neon">后台管理</h2>
    <div class="grid md:grid-cols-2 gap-6">
      <div class="cyber-border rounded-lg p-5 bg-black/20">
        <h3 class="font-bold mb-4 text-primary">作品管理</h3>
        <input id="workTitle" placeholder="标题" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 mb-2">
        <select id="workCate" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 mb-2">
          <option value="UI设计">UI设计</option>
          <option value="网页设计">网页设计</option>
          <option value="品牌设计">品牌设计</option>
        </select>
        <!-- 修改：将文件输入框改为文本输入框，用于输入网络图片链接 -->
        <input id="workImgUrl" placeholder="作品图片的网络直链 (URL)" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 mb-2">
        <button id="addWork" class="w-full bg-primary text-dark py-2 rounded hover:brightness-110 transition">添加作品</button>
        <div class="mt-4 max-h-60 overflow-y-auto" id="adminWorkList"></div>
      </div>
      <div class="cyber-border rounded-lg p-5 bg-black/20">
        <h3 class="font-bold mb-4 text-primary">用户 & 安装包管理</h3>
        <div class="max-h-60 overflow-y-auto mb-4" id="adminUserList"></div>
        <div class="max-h-60 overflow-y-auto" id="adminPackageList"></div>
      </div>
    </div>
  </div>
</section>
</main>

<!-- 作品大图预览 -->
<div id="workModal" class="fixed inset-0 z-50 hidden">
  <div class="absolute inset-0 bg-black/90" id="closeWorkModal"></div>
  <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-3xl p-5 bg-dark cyber-border rounded-lg fade-in">
    <img id="workModalImg" class="w-full max-h-[70vh] object-contain rounded" alt="作品预览">
    <h3 id="workModalTitle" class="mt-4 text-xl font-bold text-primary"></h3>
    <p id="workModalCate" class="text-gray-400 text-sm"></p>
    <div class="mt-4 flex gap-3">
      <button id="downloadSingle" class="px-4 py-2 bg-primary text-dark rounded hover:brightness-110 transition">下载此作品</button>
      <button class="px-4 py-2 bg-gray-800 rounded hover:brightness-110 transition" id="closeWorkBtn">关闭</button>
    </div>
    <button class="absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center" id="closeWorkIcon">✕</button>
  </div>
</div>

<!-- 登录弹窗 -->
<div id="loginModal" class="fixed inset-0 z-[9999] hidden">
  <div class="absolute inset-0 bg-black/80" id="closeLogin"></div>
  <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-sm p-6 bg-dark cyber-border rounded-lg fade-in">
    <h3 class="text-xl font-bold text-center mb-6 text-primary">登录 / 注册</h3>
    <input id="email" type="email" placeholder="邮箱" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 mb-3">
    <input id="pwd" type="password" placeholder="密码" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 mb-4">
    <button id="loginBtn" class="w-full bg-primary text-dark py-2 rounded hover:brightness-110 transition mb-2">登录</button>
    <button id="regBtn" class="w-full border border-primary text-primary py-2 rounded hover:bg-primary/10 transition">注册</button>
    <p id="tip" class="text-center text-sm text-green-400 mt-3 hidden"></p>
    <div class="text-center text-xs text-gray-500 mt-4">
      测试账号：admin@qq.com / admin123
    </div>
  </div>
</div>

<!-- 编辑帖子弹窗 -->
<div id="editModal" class="fixed inset-0 z-50 hidden">
  <div class="absolute inset-0 bg-black/80" id="closeEdit"></div>
  <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-sm p-6 bg-dark cyber-border rounded-lg fade-in">
    <h3 class="text-xl font-bold text-center mb-4 text-primary">编辑帖子</h3>
    <input id="editTitle" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 mb-3" maxlength="100">
    <textarea id="editContent" rows="4" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 mb-4" maxlength="1000"></textarea>
    <div class="flex gap-2">
      <button id="saveEdit" class="flex-1 bg-primary text-dark py-2 rounded hover:brightness-110 transition">保存</button>
      <button id="cancelEdit" class="px-4 bg-gray-800 text-gray-300 py-2 rounded hover:bg-gray-700 transition">取消</button>
    </div>
  </div>
</div>

<footer class="py-8 border-t border-primary/30 text-center text-sm text-gray-400 bg-dark">
  <div class="container px-4">
    <div class="neon text-lg mb-2">INFINITY 无限工作室</div>
    <p class="mb-2">专注视觉小说、人物设定与数字工艺创作</p>
    <p>© 2026 INFINITY STUDIO | 创意不止，未来可期</p>
    <div class="mt-4 flex justify-center gap-4">
      <a href="#forum" class="text-gray-400 hover:text-primary transition">论坛</a>
      <a href="#team" class="text-gray-400 hover:text-primary transition">团队</a>
      <a href="#portfolio" class="text-gray-400 hover:text-primary transition">作品</a>
    </div>
  </div>
</footer>
</div>

<script>
// ==============================
// 【核心修改】数据存储与管理 - 迁移到 JSONBin.io
// ==============================
const STORAGE_KEY = 'INFINITY_ULTIMATE';
// !!【需要您替换】!! 请替换成您自己的 Bin ID 和 Master Key
const BIN_ID = '6999d55743b1c97be9915f95';
const MASTER_KEY = '$2a$10$aOUbP3q92O7k0VFZ3itapOH0PLWruFFxuXhKHSMYb9XCbrOBeihmm';

const defData = {
  users: [
    {email:'admin@qq.com', pwd:'admin123', role:'admin'}
  ],
  works: [
    {id:'1', title:'智能设备控制', cate:'UI设计', img:'https://picsum.photos/id/237/800/600'},
    {id:'2', title:'科技官网设计', cate:'网页设计', img:'https://picsum.photos/id/239/800/600'},
    {id:'3', title:'VI视觉系统', cate:'品牌设计', img:'https://picsum.photos/id/240/800/600'}
  ],
  packages: [],
  posts: [
    {id:'1', title:'欢迎来到无限创意工作室！', content:'这里是创意分享和交流的空间，欢迎大家积极发帖讨论。', user:'admin@qq.com', time:'2026-02-17 10:30:00', comments: [
      {user:'admin@qq.com', content:'有任何问题都可以在这里提问。', time:'2026-02-17 10:35:00'}
    ]}
  ],
  user: null,
  theme: 'cyber'
};

// 【修改】加载数据 - 从云端JSONBin加载
async function load() {
  try {
    const resp = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
      headers: { 'X-Master-Key': MASTER_KEY }
    });
    const result = await resp.json();
    // 如果云端有数据则使用，否则使用默认数据
    return result.record ? result.record : JSON.parse(JSON.stringify(defData));
  } catch (error) {
    console.error('加载数据失败，使用默认数据:', error);
    return JSON.parse(JSON.stringify(defData));
  }
}

// 【修改】保存数据 - 保存到云端JSONBin
async function save(d) {
  try {
    await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'X-Master-Key': MASTER_KEY
      },
      body: JSON.stringify(d)
    });
    console.log('数据已保存到云端');
  } catch (error) {
    console.error('保存数据失败:', error);
  }
}

// 【修改】全局数据（异步初始化）
let D = {};
(async function init() {
  D = await load();
  updateUI(); // 初始化完成后更新界面
  // 启动轮播
  carousel();
})();

// ==============================
// 工具函数
// ==============================
function showTip(message, type = 'success') {
  const tip = document.getElementById('tip');
  tip.textContent = message;
  tip.className = 'text-center text-sm mt-3 ' + 
    (type === 'success' ? 'text-green-400' : 'text-red-400');
  tip.classList.remove('hidden');
  
  setTimeout(() => {
    tip.classList.add('hidden');
  }, 2000);
}

function formatTime(date) {
  const d = new Date(date);
  const now = new Date();
  const diff = now - d;
  
  // 如果是今天
  if (d.toDateString() === now.toDateString()) {
    if (diff < 60000) return '刚刚';
    if (diff < 3600000) return Math.floor(diff / 60000) + '分钟前';
    return d.toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
  }
  
  // 如果是昨天
  const yesterday = new Date(now);
  yesterday.setDate(yesterday.getDate() - 1);
  if (d.toDateString() === yesterday.toDateString()) {
    return '昨天 ' + d.toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
  }
  
  // 其他时间
  return d.toLocaleDateString('zh-CN') + ' ' + 
         d.toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
}

// ==============================
// 轮播功能
// ==============================
const carouselItems = document.querySelectorAll('.carousel-item');
const dots = document.querySelectorAll('.carousel-dot');
let carIndex = 0;

function carousel() {
  carouselItems.forEach((item, index) => {
    item.classList.remove('active');
    dots[index].classList.remove('bg-primary');
    dots[index].classList.add('bg-primary/30');
  });
  
  carIndex = (carIndex + 1) % carouselItems.length;
  carouselItems[carIndex].classList.add('active');
  dots[carIndex].classList.add('bg-primary');
}

// 自动轮播
let carouselInterval = setInterval(carousel, 4000);

// 点击切换
dots.forEach((dot, index) => {
  dot.addEventListener('click', () => {
    clearInterval(carouselInterval);
    carIndex = index - 1;
    carousel();
    carouselInterval = setInterval(carousel, 4000);
  });
});

// ==============================
// 安装包功能
// ==============================
const packageGrid = document.getElementById('packageGrid');
const uploadArea = document.getElementById('uploadArea');
const uploadPackage = document.getElementById('uploadPackage');
const adminPackageList = document.getElementById('adminPackageList');

function renderPackages() {
  if (!D.packages) D.packages = [];
  
  packageGrid.innerHTML = D.packages.length > 0 ? 
    D.packages.map(p => `
      <div class="p-6 rounded-xl cyber-border bg-black/20 slide-up cyber-card">
        <div class="flex items-center justify-between mb-3">
          <i class="fa fa-file-archive-o text-3xl text-primary"></i>
          <span class="text-xs text-gray-400">${p.size || '未知大小'}</span>
        </div>
        <h3 class="font-bold text-lg mb-1">${p.name}</h3>
        <p class="text-sm text-gray-400 mb-4">${p.desc || '无简介'}</p>
        <button class="download-package w-full bg-primary text-dark py-2 rounded hover:brightness-110 transition" 
                data-url="${p.file}">立即下载</button>
        ${D.user?.role === 'admin' ? 
          `<button class="del-package text-xs text-red-400 mt-2 w-full text-center" 
                   data-id="${p.id}">删除</button>` : ''}
      </div>
    `).join('') : 
    '<p class="text-center text-gray-400 col-span-3 py-8">暂无安装包</p>';

  // 绑定下载事件
  document.querySelectorAll('.download-package').forEach(btn => {
    btn.addEventListener('click', function() {
      const url = this.getAttribute('data-url');
      if (url) {
        window.open(url, '_blank'); // 直接打开网络链接
      } else {
        showTip('下载链接无效', 'error');
      }
    });
  });

  // 绑定删除事件
  document.querySelectorAll('.del-package').forEach(btn => {
    btn.addEventListener('click', function() {
      if (confirm('确定删除此安装包吗？')) {
        D.packages = D.packages.filter(x => String(x.id) !== String(this.dataset.id));
        save(D);
        renderPackages();
        renderAdminPackages();
        showTip('删除成功');
      }
    });
  });
}

// 【修改】上传安装包逻辑 - 改为输入URL
uploadPackage.addEventListener('click', function() {
  const name = document.getElementById('packageName').value.trim();
  const desc = document.getElementById('packageDesc').value.trim();
  const fileUrl = document.getElementById('packageFileUrl').value.trim();
  
  if (!name) {
    showTip('请输入安装包名称', 'error');
    return;
  }
  
  if (!fileUrl) {
    showTip('请输入安装包的网络链接', 'error');
    return;
  }
  
  // 简单验证URL格式
  if (!fileUrl.startsWith('http://') && !fileUrl.startsWith('https://')) {
    showTip('请输入有效的网络链接（以 http:// 或 https:// 开头）', 'error');
    return;
  }
  
  const newPackage = {
    id: Date.now().toString(),
    name: name,
    desc: desc,
    file: fileUrl, // 存储网络链接
    size: '网络文件', // 由于是外部链接，大小未知
    uploadTime: new Date().toISOString()
  };
  
  D.packages.unshift(newPackage);
  save(D);
  
  // 清空表单
  document.getElementById('packageName').value = '';
  document.getElementById('packageDesc').value = '';
  document.getElementById('packageFileUrl').value = '';
  
  renderPackages();
  renderAdminPackages();
  showTip('上传成功！');
});

function renderAdminPackages() {
  if (!D.packages) D.packages = [];
  
  adminPackageList.innerHTML = `<div class="font-bold text-primary mb-2">安装包管理</div>` + 
    (D.packages.length > 0 ? 
      D.packages.map(p => `
        <div class="flex justify-between items-center border-b border-gray-800 py-2 text-sm">
          <div class="truncate flex-1 mr-2">${p.name}</div>
          <button class="del-admin-package text-red-400 text-xs px-2 py-1 hover:bg-red-900/20 rounded" 
                  data-id="${p.id}">删除</button>
        </div>
      `).join('') : 
      '<p class="text-gray-400 text-sm">暂无安装包</p>');

  // 绑定管理员删除事件
  document.querySelectorAll('.del-admin-package').forEach(btn => {
    btn.addEventListener('click', function() {
      if (confirm('确定删除此安装包吗？')) {
        D.packages = D.packages.filter(x => String(x.id) !== String(this.dataset.id));
        save(D);
        renderPackages();
        renderAdminPackages();
      }
    });
  });
}

// ==============================
// 作品集功能
// ==============================
const portfolioGrid = document.getElementById('portfolioGrid');
const searchWork = document.getElementById('searchWork');
const workModal = document.getElementById('workModal');
const workModalImg = document.getElementById('workModalImg');
const workModalTitle = document.getElementById('workModalTitle');
const workModalCate = document.getElementById('workModalCate');
const downloadSingle = document.getElementById('downloadSingle');
let currentWorkId = null;

function renderPortfolio(filterCate = 'all', keyword = '') {
  let list = D.works || [];
  
  if (filterCate !== 'all') {
    list = list.filter(x => x.cate === filterCate);
  }
  
  if (keyword) {
    list = list.filter(x => x.title.toLowerCase().includes(keyword.toLowerCase()));
  }
  
  portfolioGrid.innerHTML = list.length > 0 ? 
    list.map(w => `
      <div class="rounded-xl overflow-hidden cyber-border bg-black/20 shadow slide-up cyber-card">
        <div class="overflow-hidden cursor-pointer">
          <img src="${w.img}" class="w-full h-52 object-cover img-scale view-work" 
               data-id="${w.id}" alt="${w.title}">
        </div>
        <div class="p-4">
          <h3 class="font-bold text-lg mb-1">${w.title}</h3>
          <div class="flex justify-between items-center">
            <span class="text-xs text-primary bg-primary/10 px-2 py-1 rounded">${w.cate}</span>
            <button class="text-xs text-gray-400 hover:text-primary view-work" 
                    data-id="${w.id}">查看详情</button>
          </div>
        </div>
      </div>
    `).join('') : 
    '<p class="text-center text-gray-400 col-span-3 py-8">暂无作品</p>';

  // 绑定查看事件
  document.querySelectorAll('.view-work').forEach(btn => {
    btn.addEventListener('click', function() {
      const work = D.works.find(x => String(x.id) === String(this.dataset.id));
      if (work) {
        currentWorkId = work.id;
        workModalImg.src = work.img;
        workModalImg.alt = work.title;
        workModalTitle.textContent = work.title;
        workModalCate.textContent = work.cate;
        workModal.classList.remove('hidden');
      }
    });
  });
}

// 关闭作品模态框
document.getElementById('closeWorkBtn').addEventListener('click', () => {
  workModal.classList.add('hidden');
});

document.getElementById('closeWorkIcon').addEventListener('click', () => {
  workModal.classList.add('hidden');
});

document.getElementById('closeWorkModal').addEventListener('click', () => {
  workModal.classList.add('hidden');
});

// 下载作品
downloadSingle.addEventListener('click', () => {
  const work = D.works.find(x => String(x.id) === String(currentWorkId));
  if (work) {
    window.open(work.img, '_blank'); // 直接在新标签页打开图片链接
    showTip('正在打开图片');
  }
});

// 分类筛选
document.querySelectorAll('.cate-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.cate-btn').forEach(b => {
      b.classList.remove('bg-primary', 'text-dark');
      b.classList.add('bg-gray-800');
    });
    
    this.classList.add('bg-primary', 'text-dark');
    renderPortfolio(this.dataset.cate, searchWork.value);
  });
});

// 搜索功能
searchWork.addEventListener('input', function() {
  const activeBtn = document.querySelector('.cate-btn.bg-primary');
  const cate = activeBtn ? activeBtn.dataset.cate : 'all';
  renderPortfolio(cate, this.value);
});

// ==============================
// 论坛功能 - 优化版
// ==============================
let editPostId = null;

function renderPosts() {
  const postList = document.getElementById('postList');
  const noPosts = document.getElementById('noPosts');
  const postCount = document.getElementById('postCount');
  
  if (!D.posts) D.posts = [];
  
  if (D.posts.length === 0) {
    postList.innerHTML = '';
    noPosts.classList.remove('hidden');
    postCount.textContent = '0个帖子';
    return;
  }
  
  noPosts.classList.add('hidden');
  postCount.textContent = `${D.posts.length}个帖子`;
  
  postList.innerHTML = D.posts.map((post, index) => {
    const canEdit = D.user && (D.user.email === post.user || D.user.role === 'admin');
    const isAdmin = D.user && D.user.role === 'admin';
    
    return `
      <div class="border border-gray-800 rounded-lg p-4 slide-up bg-black/10" data-post-id="${post.id}">
        <div class="flex justify-between items-start mb-3">
          <div>
            <h4 class="font-bold text-lg text-primary cursor-pointer hover:underline post-title">${post.title}</h4>
            <div class="text-xs text-gray-400 mt-1">
              <span class="text-secondary">${post.user}</span>
              <span class="mx-2">•</span>
              <span>${formatTime(post.time)}</span>
              ${post.edited ? '<span class="ml-2 text-gray-500">(已编辑)</span>' : ''}
            </div>
          </div>
          ${canEdit ? `
            <div class="flex gap-2">
              <button class="edit-post-btn text-xs text-secondary hover:text-primary px-2 py-1 rounded hover:bg-secondary/10" 
                      data-id="${post.id}">编辑</button>
              <button class="delete-post-btn text-xs text-red-400 hover:text-red-300 px-2 py-1 rounded hover:bg-red-900/20" 
                      data-id="${post.id}">删除</button>
            </div>
          ` : ''}
        </div>
        
        <div class="text-gray-300 mb-4 post-content">${post.content}</div>
        
        <div class="border-t border-gray-800 pt-3">
          <div class="text-xs font-semibold text-gray-400 mb-2">
            评论 (${post.comments ? post.comments.length : 0})
          </div>
          
          <div class="comments mb-3 space-y-2">
            ${post.comments && post.comments.length > 0 ? 
              post.comments.map(comment => `
                <div class="border-l-2 border-primary/30 pl-3 py-1 text-sm">
                  <div class="flex justify-between">
                    <span class="text-primary font-medium">${comment.user}</span>
                    <span class="text-gray-500 text-xs">${formatTime(comment.time)}</span>
                  </div>
                  <div class="text-gray-300 mt-1">${comment.content}</div>
                  ${(D.user && (D.user.email === comment.user || isAdmin)) ? `
                    <button class="delete-comment-btn text-xs text-red-400 mt-1" 
                            data-post-id="${post.id}" data-comment-index="${post.comments.indexOf(comment)}">
                      删除
                    </button>
                  ` : ''}
                </div>
              `).join('') : 
              '<p class="text-gray-500 text-sm text-center py-2">暂无评论</p>'
            }
          </div>
          
          <div class="comment-form">
            ${D.user ? `
              <div class="flex gap-2">
                <input type="text" 
                       class="flex-1 bg-gray-900 border border-gray-700 rounded px-3 py-2 text-sm comment-input" 
                       placeholder="写下你的评论..." 
                       maxlength="200"
                       data-post-id="${post.id}">
                <button class="send-comment-btn bg-primary text-dark px-3 py-2 rounded text-sm hover:brightness-110 transition"
                        data-post-id="${post.id}">发送</button>
              </div>
            ` : `
              <p class="text-center text-gray-500 text-sm py-2">
                请<a href="javascript:void(0)" onclick="showLogin()" class="text-primary hover:underline">登录</a>后发表评论
              </p>
            `}
          </div>
        </div>
      </div>
    `;
  }).join('');
  
  bindPostEvents();
}

function bindPostEvents() {
  // 编辑帖子
  document.querySelectorAll('.edit-post-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.stopPropagation();
      const postId = this.dataset.id;
      const post = D.posts.find(p => String(p.id) === String(postId));
      
      if (post) {
        editPostId = postId;
        document.getElementById('editTitle').value = post.title;
        document.getElementById('editContent').value = post.content;
        document.getElementById('editModal').classList.remove('hidden');
      }
    });
  });
  
  // 删除帖子
  document.querySelectorAll('.delete-post-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.stopPropagation();
      const postId = this.dataset.id;
      
      if (confirm('确定要删除这个帖子吗？删除后将无法恢复。')) {
        D.posts = D.posts.filter(p => String(p.id) !== String(postId));
        save(D);
        renderPosts();
        showTip('帖子已删除');
      }
    });
  });
  
  // 发送评论
  document.querySelectorAll('.send-comment-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.stopPropagation();
      const postId = this.dataset.postId;
      const input = document.querySelector(`.comment-input[data-post-id="${postId}"]`);
      const content = input.value.trim();
      
      if (!content) {
        showTip('评论内容不能为空', 'error');
        return;
      }
      
      const post = D.posts.find(p => String(p.id) === String(postId));
      if (post) {
        if (!post.comments) post.comments = [];
        
        post.comments.push({
          user: D.user.email,
          content: content,
          time: new Date().toISOString()
        });
        
        save(D);
        renderPosts();
        input.value = '';
        showTip('评论已发布');
      }
    });
  });
  
  // 评论输入框回车发送
  document.querySelectorAll('.comment-input').forEach(input => {
    input.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        const postId = this.dataset.postId;
        const btn = document.querySelector(`.send-comment-btn[data-post-id="${postId}"]`);
        if (btn) btn.click();
      }
    });
  });
  
  // 删除评论
  document.querySelectorAll('.delete-comment-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.stopPropagation();
      const postId = this.dataset.postId;
      const commentIndex = parseInt(this.dataset.commentIndex);
      
      if (confirm('确定要删除这条评论吗？')) {
        const post = D.posts.find(p => String(p.id) === String(postId));
        if (post && post.comments && post.comments[commentIndex]) {
          post.comments.splice(commentIndex, 1);
          save(D);
          renderPosts();
          showTip('评论已删除');
        }
      }
    });
  });
  
  // 点击帖子标题查看详情
  document.querySelectorAll('.post-title').forEach(title => {
    title.addEventListener('click', function() {
      const postDiv = this.closest('[data-post-id]');
      const postId = postDiv.dataset.postId;
      const post = D.posts.find(p => String(p.id) === String(postId));
      
      if (post) {
        alert(`帖子详情\n\n标题: ${post.title}\n作者: ${post.user}\n时间: ${formatTime(post.time)}\n内容: ${post.content}`);
      }
    });
  });
}

// 帖子发布功能
document.getElementById('sendPost').addEventListener('click', function() {
  const title = document.getElementById('postTitle').value.trim();
  const content = document.getElementById('postContent').value.trim();
  
  if (!title) {
    showTip('请输入帖子标题', 'error');
    return;
  }
  
  if (!content) {
    showTip('请输入帖子内容', 'error');
    return;
  }
  
  const newPost = {
    id: Date.now().toString(),
    title: title,
    content: content,
    user: D.user.email,
    time: new Date().toISOString(),
    edited: false,
    comments: []
  };
  
  D.posts.unshift(newPost);
  save(D);
  
  // 清空表单
  document.getElementById('postTitle').value = '';
  document.getElementById('postContent').value = '';
  document.getElementById('charCount').textContent = '0/1000';
  
  renderPosts();
  showTip('帖子发布成功！');
});

// 清空帖子表单
document.getElementById('clearPost').addEventListener('click', function() {
  if (confirm('确定要清空当前内容吗？')) {
    document.getElementById('postTitle').value = '';
    document.getElementById('postContent').value = '';
    document.getElementById('charCount').textContent = '0/1000';
    showTip('已清空');
  }
});

// 字符计数
document.getElementById('postContent').addEventListener('input', function() {
  const count = this.value.length;
  document.getElementById('charCount').textContent = `${count}/1000`;
  
  if (count > 950) {
    document.getElementById('charCount').className = 'text-xs text-red-400';
  } else if (count > 800) {
    document.getElementById('charCount').className = 'text-xs text-yellow-400';
  } else {
    document.getElementById('charCount').className = 'text-xs text-gray-500';
  }
});

// ==============================
// 编辑帖子功能
// ==============================
document.getElementById('saveEdit').addEventListener('click', function() {
  const title = document.getElementById('editTitle').value.trim();
  const content = document.getElementById('editContent').value.trim();
  
  if (!title) {
    showTip('请输入帖子标题', 'error');
    return;
  }
  
  if (!content) {
    showTip('请输入帖子内容', 'error');
    return;
  }
  
  const post = D.posts.find(p => String(p.id) === String(editPostId));
  if (post) {
    post.title = title;
    post.content = content;
    post.edited = true;
    post.time = new Date().toISOString();
    
    save(D);
    renderPosts();
    document.getElementById('editModal').classList.add('hidden');
    editPostId = null;
    showTip('帖子已更新');
  }
});

// 取消编辑
document.getElementById('cancelEdit').addEventListener('click', function() {
  editPostId = null;
  document.getElementById('editModal').classList.add('hidden');
});

// 关闭编辑模态框
document.getElementById('closeEdit').addEventListener('click', function() {
  editPostId = null;
  document.getElementById('editModal').classList.add('hidden');
});

// ==============================
// 登录功能
// ==============================
function showLogin() {
  document.getElementById('loginModal').classList.remove('hidden');
}

function hideLogin() {
  document.getElementById('loginModal').classList.add('hidden');
}

document.getElementById('loginToggle').addEventListener('click', function() {
  if (D.user) {
    if (confirm('确定要退出登录吗？')) {
      D.user = null;
      save(D);
      updateUI();
      showTip('已退出登录');
    }
  } else {
    showLogin();
  }
});

document.getElementById('mobileLogin').addEventListener('click', function() {
  if (D.user) {
    if (confirm('确定要退出登录吗？')) {
      D.user = null;
      save(D);
      updateUI();
      showTip('已退出登录');
    }
  } else {
    document.getElementById('mobileMenu').classList.add('hidden');
    showLogin();
  }
});

// 登录弹窗关闭
document.getElementById('closeLogin').addEventListener('click', hideLogin);

// 登录按钮
document.getElementById('loginBtn').addEventListener('click', function() {
  const email = document.getElementById('email').value.trim();
  const pwd = document.getElementById('pwd').value.trim();
  
  if (!email || !pwd) {
    showTip('请输入邮箱和密码', 'error');
    return;
  }
  
  const user = D.users.find(u => u.email === email && u.pwd === pwd);
  if (!user) {
    showTip('邮箱或密码错误', 'error');
    return;
  }
  
  D.user = user;
  save(D);
  
  // 清空表单
  document.getElementById('email').value = '';
  document.getElementById('pwd').value = '';
  
  hideLogin();
  updateUI();
  showTip('登录成功！');
});

// 注册按钮
document.getElementById('regBtn').addEventListener('click', function() {
  const email = document.getElementById('email').value.trim();
  const pwd = document.getElementById('pwd').value.trim();
  
  if (!email || !pwd) {
    showTip('请输入邮箱和密码', 'error');
    return;
  }
  
  // 简单的邮箱验证
  if (!email.includes('@') || !email.includes('.')) {
    showTip('请输入有效的邮箱地址', 'error');
    return;
  }
  
  if (pwd.length < 6) {
    showTip('密码长度至少6位', 'error');
    return;
  }
  
  if (D.users.some(u => u.email === email)) {
    showTip('该邮箱已注册', 'error');
    return;
  }
  
  const newUser = {
    email: email,
    pwd: pwd,
    role: 'user'
  };
  
  D.users.push(newUser);
  save(D);
  
  // 自动登录
  D.user = newUser;
  
  // 清空表单
  document.getElementById('email').value = '';
  document.getElementById('pwd').value = '';
  
  hideLogin();
  updateUI();
  showTip('注册成功，已自动登录！');
});

// ==============================
// 主题功能
// ==============================
const themeNames = { cyber: '赛博蓝', sunset: '落日橙', forest: '极光绿' };
const themes = {
  cyber: { p: '#0ef', s: '#f0a' },
  sunset: { p: '#f90', s: '#f06' },
  forest: { p: '#0f6', s: '#096' }
};

let currentTheme = D.theme || 'cyber';

function updateThemeButtonText() {
  document.getElementById('themeBtn').textContent = `主题: ${themeNames[currentTheme]}`;
  document.getElementById('mobileTheme').textContent = `主题: ${themeNames[currentTheme]}`;
}

function setTheme(theme) {
  currentTheme = theme;
  D.theme = theme;
  save(D);
  
  const colors = themes[theme];
  
  // 更新CSS变量
  document.documentElement.style.setProperty('--color-primary', colors.p);
  document.documentElement.style.setProperty('--color-secondary', colors.s);
  
  updateThemeButtonText();
  showTip(`已切换至${themeNames[theme]}主题`);
}

function switchTheme() {
  const themeOrder = ['cyber', 'sunset', 'forest'];
  const currentIndex = themeOrder.indexOf(currentTheme);
  const nextIndex = (currentIndex + 1) % themeOrder.length;
  setTheme(themeOrder[nextIndex]);
}

document.getElementById('themeBtn').addEventListener('click', switchTheme);
document.getElementById('mobileTheme').addEventListener('click', function() {
  switchTheme();
  document.getElementById('mobileMenu').classList.add('hidden');
});

// ==============================
// 后台管理
// ==============================
const adminBtn = document.getElementById('adminBtn');
const addWork = document.getElementById('addWork');
const adminWorkList = document.getElementById('adminWorkList');
const adminUserList = document.getElementById('adminUserList');
const adminPanel = document.getElementById('adminPanel');

adminBtn.addEventListener('click', function() {
  adminPanel.classList.toggle('hidden');
  if (!adminPanel.classList.contains('hidden')) {
    renderAdmin();
  }
});

function renderAdmin() {
  // 作品管理
  adminWorkList.innerHTML = `
    <div class="font-bold text-primary mb-2">作品管理 (${D.works.length})</div>
    ${D.works.map(work => `
      <div class="flex justify-between items-center border-b border-gray-800 py-2 text-sm">
        <div class="truncate flex-1 mr-2">${work.title}</div>
        <button class="del-admin-work text-red-400 text-xs px-2 py-1 hover:bg-red-900/20 rounded" 
                data-id="${work.id}">删除</button>
      </div>
    `).join('')}
  `;
  
  // 用户管理
  adminUserList.innerHTML = `
    <div class="font-bold text-primary mb-2">用户管理 (${D.users.length})</div>
    ${D.users.map(user => `
      <div class="flex justify-between items-center border-b border-gray-800 py-2 text-sm">
        <div class="truncate flex-1 mr-2">
          ${user.email}
          <span class="text-gray-500">(${user.role})</span>
        </div>
        ${user.role !== 'admin' ? `
          <button class="del-admin-user text-red-400 text-xs px-2 py-1 hover:bg-red-900/20 rounded" 
                  data-email="${user.email}">删除</button>
        ` : '<span class="text-gray-500 text-xs">管理员</span>'}
      </div>
    `).join('')}
  `;
  
  bindAdminEvents();
}

function bindAdminEvents() {
  // 删除作品
  document.querySelectorAll('.del-admin-work').forEach(btn => {
    btn.addEventListener('click', function() {
      if (confirm('确定删除这个作品吗？')) {
        D.works = D.works.filter(w => String(w.id) !== String(this.dataset.id));
        save(D);
        renderAdmin();
        renderPortfolio();
        showTip('作品已删除');
      }
    });
  });
  
  // 删除用户
  document.querySelectorAll('.del-admin-user').forEach(btn => {
    btn.addEventListener('click', function() {
      const email = this.dataset.email;
      if (confirm(`确定删除用户 ${email} 吗？`)) {
        D.users = D.users.filter(u => u.email !== email);
        save(D);
        renderAdmin();
        showTip('用户已删除');
      }
    });
  });
}

// 【修改】添加作品逻辑 - 改为输入图片URL
addWork.addEventListener('click', function() {
  const title = document.getElementById('workTitle').value.trim();
  const cate = document.getElementById('workCate').value;
  const imgUrl = document.getElementById('workImgUrl').value.trim();
  
  if (!title) {
    showTip('请输入作品标题', 'error');
    return;
  }
  
  if (!imgUrl) {
    showTip('请输入作品图片的网络链接', 'error');
    return;
  }
  
  // 简单验证URL格式
  if (!imgUrl.startsWith('http://') && !imgUrl.startsWith('https://')) {
    showTip('请输入有效的网络链接（以 http:// 或 https:// 开头）', 'error');
    return;
  }
  
  const newWork = {
    id: Date.now().toString(),
    title: title,
    cate: cate,
    img: imgUrl // 存储网络图片链接
  };
  
  D.works.push(newWork);
  save(D);
  
  // 清空表单
  document.getElementById('workTitle').value = '';
  document.getElementById('workImgUrl').value = '';
  
  renderAdmin();
  renderPortfolio();
  showTip('作品添加成功！');
});

// ==============================
// 移动端菜单
// ==============================
document.getElementById('menuBtn').addEventListener('click', function() {
  document.getElementById('mobileMenu').classList.toggle('hidden');
});

// 点击菜单项后关闭菜单
document.querySelectorAll('#mobileMenu a').forEach(link => {
  link.addEventListener('click', () => {
    document.getElementById('mobileMenu').classList.add('hidden');
  });
});

// ==============================
// 全局UI更新
// ==============================
function updateUI() {
  // 更新登录状态
  if (D.user) {
    document.getElementById('loginToggle').textContent = `退出 (${D.user.email})`;
    document.getElementById('mobileLogin').textContent = `退出 (${D.user.email})`;
    
    // 显示发布区域
    document.getElementById('postArea').classList.remove('hidden');
    document.getElementById('needLogin').classList.add('hidden');
    
    // 管理员功能
    if (D.user.role === 'admin') {
      document.getElementById('adminBtn').classList.remove('hidden');
      document.getElementById('uploadArea').classList.remove('hidden');
    } else {
      document.getElementById('adminBtn').classList.add('hidden');
      document.getElementById('uploadArea').classList.add('hidden');
    }
  } else {
    document.getElementById('loginToggle').textContent = '登录';
    document.getElementById('mobileLogin').textContent = '登录';
    
    // 隐藏发布区域
    document.getElementById('postArea').classList.add('hidden');
    document.getElementById('needLogin').classList.remove('hidden');
    
    // 隐藏管理员功能
    document.getElementById('adminBtn').classList.add('hidden');
    document.getElementById('uploadArea').classList.add('hidden');
  }
  
  // 渲染各模块
  renderPortfolio();
  renderPackages();
  renderPosts();
  
  // 更新主题
  updateThemeButtonText();
  setTheme(currentTheme);
}

// ==============================
// 平滑滚动
// ==============================
document.addEventListener('DOMContentLoaded', function() {
  // 初始化已完成在 init() 异步函数中
  
  // 平滑滚动
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
      const href = this.getAttribute('href');
      if (href === '#') return;
      
      const target = document.querySelector(href);
      if (target) {
        e.preventDefault();
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });
});
</script>
</body>
</html>
